# Simple transform flow test - equivalent to the basic test in transform_flow_graph_test.cpp
data_sources:
  price_data: "datasets/sample_ohlcv.yaml"

tests:
  - title: "Single asset, single timeframe with sequential graph"
    assets: ["AAPL", "MSFT"]
    timeframes: ["1D"]
    configuration:
      transforms:
        - type: "market_data_source"
          id: "data"
          timeframe: "1D"
        - type: "number"
          id: "two"
          timeframe: "1D"
          options:
            value: 2
        - type: "add"
          id: "0"
          timeframe: "1D"
          inputs:
            SLOT0: "data#c"
            SLOT1: "two#result"
        - type: "mul"
          id: "1"
          timeframe: "1D"
          inputs:
            SLOT0: "0#result"
            SLOT1: "data#h"
    expect:
      type: "flow_graph"
      dataframes:
        "1D":
          AAPL:
            columns: ["c", "h", "o", "l", "v", "two#result", "0#result", "1#result"]
            timestamps: ["2020-01-01T00:00:00", "2020-01-02T00:00:00", "2020-01-03T00:00:00"]
            values: [
              [2.0, 4.0, 6.0],
              [4.0, 6.0, 10.0],
              [1.5, 2.5, 4.5],
              [1.0, 2.0, 4.0],
              [1000, 1200, 1500],
              [2.0, 2.0, 2.0],
              [4.0, 6.0, 8.0],
              [16.0, 36.0, 80.0]
            ]
          MSFT:
            columns: ["c", "h", "o", "l", "v", "two#result", "0#result", "1#result"]
            timestamps: ["2020-01-01T00:00:00", "2020-01-02T00:00:00", "2020-01-03T00:00:00"]
            values: [
              [10.0, 20.0, 30.0],
              [40.0, 40.0, 40.0],
              [8.0, 15.0, 25.0],
              [7.0, 12.0, 20.0],
              [2000, 2200, 2500],
              [2.0, 2.0, 2.0],
              [12.0, 22.0, 32.0],
              [480.0, 880.0, 1280.0]
            ]
      tearsheets: {}

  - title: "Empty assets and empty configs"
    assets: []
    timeframes: []
    configuration:
      transforms: []
    input:
      "1D": {}
    expect:
      type: "flow_graph"
      dataframes: {}
      tearsheets: {}

  - title: "Multiple parallel transforms on single timeframe"
    assets: ["AAPL", "MSFT"]
    timeframes: ["1D"]
    configuration:
      transforms:
        - type: "market_data_source"
          id: "data"
          timeframe: "1D"
        - type: "number"
          id: "two"
          timeframe: "1D"
          options:
            value: 2
        - type: "number"
          id: "three"
          timeframe: "1D"
          options:
            value: 3
        - type: "add"
          id: "0"
          timeframe: "1D"
          inputs:
            SLOT0: "data#c"
            SLOT1: "two#result"
        - type: "mul"
          id: "1"
          timeframe: "1D"
          inputs:
            SLOT0: "data#h"
            SLOT1: "three#result"
    expect:
      type: "flow_graph"
      dataframes:
        "1D":
          AAPL:
            columns: ["c", "h", "o", "l", "v", "two#result", "three#result", "0#result", "1#result"]
            timestamps: ["2020-01-01T00:00:00", "2020-01-02T00:00:00", "2020-01-03T00:00:00"]
            values: [
              [2.0, 4.0, 6.0],
              [4.0, 6.0, 10.0],
              [1.5, 2.5, 4.5],
              [1.0, 2.0, 4.0],
              [1000, 1200, 1500],
              [2.0, 2.0, 2.0],
              [3.0, 3.0, 3.0],
              [4.0, 6.0, 8.0],
              [12.0, 18.0, 30.0]
            ]
          MSFT:
            columns: ["c", "h", "o", "l", "v", "two#result", "three#result", "0#result", "1#result"]
            timestamps: ["2020-01-01T00:00:00", "2020-01-02T00:00:00", "2020-01-03T00:00:00"]
            values: [
              [10.0, 20.0, 30.0],
              [40.0, 40.0, 40.0],
              [8.0, 15.0, 25.0],
              [7.0, 12.0, 20.0],
              [2000, 2200, 2500],
              [2.0, 2.0, 2.0],
              [3.0, 3.0, 3.0],
              [12.0, 22.0, 32.0],
              [120.0, 120.0, 120.0]
            ]
      tearsheets: {}