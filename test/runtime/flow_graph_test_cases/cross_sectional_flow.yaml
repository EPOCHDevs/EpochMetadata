# Cross-sectional transform fl test
data_sources:
  price_data: "datasets/sample_ohlcv.yaml"

tests:
  - title: "Cross-sectional returns transform"
    assets: ["AAPL", "MSFT"]
    timeframes: ["1D"]
    configuration:
      transforms:
        - type: "market_data_source"
          id: "data"
          timeframe: "1D"
        - type: "roc"
          id: "0"
          timeframe: "1D"
          inputs:
            SLOT: "data#c"
          options:
            period: 1
        - type: "cs_momentum"
          id: "1"
          timeframe: "1D"
          inputs:
            SLOT: "0#result"
    expect:
      type: "flow_graph"
      dataframes:
        "1D":
          AAPL:
            columns: ["c", "h", "o", "l", "v", "0#result", "1#result"]
            values: [
              [2.0, 4.0, 6.0],
              [4.0, 6.0, 10.0],
              [1.5, 2.5, 4.5],
              [1.0, 2.0, 4.0],
              [1000, 1200, 1500],
              [~, 1.0, 0.5],
              [~, 2.0, 3.0]
            ]
          MSFT:
            columns: ["c", "h", "o", "l", "v", "0#result", "1#result"]
            values: [
              [10.0, 20.0, 30.0],
              [40.0, 40.0, 40.0],
              [8.0, 15.0, 25.0],
              [7.0, 12.0, 20.0],
              [2000, 2200, 2500],
              [~, 1.0, 0.5],
              [~, 2.0, 3.0]
            ]
      tearsheets: {}

  - title: "Cross-sectional TopK transform"
    assets: ["AAPL", "MSFT"]
    timeframes: ["1D"]
    configuration:
      transforms:
        - type: "market_data_source"
          id: "data"
          timeframe: "1D"
        - type: "top_k"
          id: "1"
          timeframe: "1D"
          inputs:
            SLOT : "data#c"
          options:
            k: 1
    expect:
      type: "flow_graph"
      dataframes:
        "1D":
          AAPL:
            columns: ["c", "h", "o", "l", "v", "1#result"]
            values: [
              [2.0, 4.0, 6.0],
              [4.0, 6.0, 10.0],
              [1.5, 2.5, 4.5],
              [1.0, 2.0, 4.0],
              [1000, 1200, 1500],
              [false, false, false]
            ]
          MSFT:
            columns: ["c", "h", "o", "l", "v", "1#result"]
            values: [
              [10.0, 20.0, 30.0],
              [40.0, 40.0, 40.0],
              [8.0, 15.0, 25.0],
              [7.0, 12.0, 20.0],
              [2000, 2200, 2500],
              [true, true, true]
            ]
      tearsheets: {}