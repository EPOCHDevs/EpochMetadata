# Complex flow test with SMA -> ROC -> Cross-sectional -> Add operations
data_sources:
  price_data: "datasets/sample_ohlcv.yaml"

tests:
  - title: "SMA(2) -> ROC(1) -> cross sectional -> add10 and add20"
    assets: ["AAPL", "MSFT"]
    timeframes: ["1D"]
    configuration:
      transforms:
        - type: "market_data_source"
          id: "data"
          timeframe: "1D"
        - type: "sma"
          id: "0"
          timeframe: "1D"
          inputs:
            SLOT: "data#c"
          options:
            period: 2
        - type: "roc"
          id: "11"
          timeframe: "1D"
          inputs:
            SLOT: "data#c"
          options:
            period: 1
        - type: "cs_momentum"
          id: "1"
          timeframe: "1D"
          inputs:
            SLOT: "11#result"
        - type: "number"
          id: "ten"
          timeframe: "1D"
          options:
            value: 10
        - type: "number"
          id: "twenty"
          timeframe: "1D"
          options:
            value: 20
        - type: "add"
          id: "2"
          timeframe: "1D"
          inputs:
            SLOT0: "1#result"
            SLOT1: "ten#result"
        - type: "add"
          id: "3"
          timeframe: "1D"
          inputs:
            SLOT0: "0#result"
            SLOT1: "twenty#result"
    expect:
      type: "flow_graph"
      dataframes:
        "1D":
          AAPL:
            columns: ["c", "h", "o", "l", "v", "0#result", "11#result", "1#result", "ten#result", "twenty#result", "2#result", "3#result"]
            values: [
              [2.0, 4.0, 6.0],
              [4.0, 6.0, 10.0],
              [1.5, 2.5, 4.5],
              [1.0, 2.0, 4.0],
              [1000, 1200, 1500],
              [~, 3.0, 5.0],
              [~, 1.0, 0.5],
              [~, 2.0, 3.0],
              [10.0, 10.0, 10.0],
              [20.0, 20.0, 20.0],
              [~, 12.0, 13.0],
              [~, 23.0, 25.0]
            ]
          MSFT:
            columns: ["c", "h", "o", "l", "v", "0#result", "11#result", "1#result", "ten#result", "twenty#result", "2#result", "3#result"]
            values: [
              [10.0, 20.0, 30.0],
              [40.0, 40.0, 40.0],
              [8.0, 15.0, 25.0],
              [7.0, 12.0, 20.0],
              [2000, 2200, 2500],
              [~, 15.0, 25.0],
              [~, 1.0, 0.5],
              [~, 2.0, 3.0],
              [10.0, 10.0, 10.0],
              [20.0, 20.0, 20.0],
              [~, 12.0, 13.0],
              [~, 35.0, 45.0]
            ]
      tearsheets: {}