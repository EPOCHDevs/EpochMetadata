{
  "id": "adaptive_momentum_cci_strategy",
  "name": "Adaptive Momentum CCI Strategy",
  "description": "This strategy utilizes the Commodity Channel Index (CCI) to identify momentum trends in the market. By calculating the CCI based on average price movements, it aims to capture potential price reversals and continuations, optimizing trading decisions based on momentum shifts.",
  "algorithm_type": "Momentum",
  "prompt": "import pandas as pd\nimport numpy as np\n\ndef calculate_cci(data, period=20):\n    tp = (data['high'] + data['low'] + data['close']) / 3\n    sma_tp = tp.rolling(window=period, min_periods=period).mean()\n    mad = tp.rolling(window=period, min_periods=period).apply(lambda x: np.mean(np.abs(x - np.mean(x))), raw=True)\n    cci = (tp - sma_tp) / (0.015 * mad)\n    return cci\n\ndef calculate_vhf(data, period=28):\n    highest_close = data['close'].rolling(window=period, min_periods=period).max()\n    lowest_close = data['close'].rolling(window=period, min_periods=period).min()\n    num = highest_close - lowest_close\n    denom = data['close'].diff().abs().rolling(window=period, min_periods=period).sum()\n    vhf = num / denom\n    return vhf\n\ndef trading_strategy(data):\n    data = data.copy()\n    \n    # - VHF (Vertical Horizontal Filter) to detect trend/non-trend regime\n    # - CCI (Commodity Channel Index) for overbought/oversold detection\n    # - ATR for dynamic stop/trailing\n    vhf_period = 28\n    cci_period = 20\n    atr_period = 14\n    \n    data['cci'] = calculate_cci(data, period=cci_period)\n    data['vhf'] = calculate_vhf(data, period=vhf_period)\n    data['atr'] = data['high'].combine(data['low'], np.subtract) \\\n                  .abs().rolling(window=atr_period).mean()\n    \n    # Determine regime\n    vhf_threshold = data['vhf'].quantile(0.7)\n    data['regime'] = np.where(data['vhf'] > vhf_threshold, 'trend', 'mean')\n    \n    # Generate signals based on regime:\n    data['signal'] = 0\n    # Trend regime: buy on strong CCI upward cross with confirmation of momentum\n    data['cci_prev'] = data['cci'].shift(1)\n    up_cross = (data['cci_prev'] < 100) & (data['cci'] >= 100)\n    down_cross = (data['cci_prev'] > -100) & (data['cci'] <= -100)\n    \n    data.loc[(data['regime'] == 'trend') & up_cross, 'signal'] = 1\n    data.loc[(data['regime'] == 'trend') & down_cross, 'signal'] = -1\n    \n    # Mean reversion regime: fade CCI extremes\n    high_extreme = data['cci'] > 200\n    low_extreme = data['cci'] < -200\n    data.loc[(data['regime'] == 'mean') & high_extreme, 'signal'] = -1\n    data.loc[(data['regime'] == 'mean') & low_extreme, 'signal'] = 1\n    \n    data['signal'] = data['signal'].fillna(0)\n    return data",
  "blueprint": {
    "nodes": [
      {
        "id": "src",
        "type": "market_data_source",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "day",
          "interval": 1
        }
      },
      {
        "id": "vhf",
        "type": "vhf",
        "options": [
          {
            "id": "period",
            "value": 28,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "thr_const",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 0.5,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "trend_gt",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "not_trend",
        "type": "logical_not",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "cci",
        "type": "cci",
        "options": [
          {
            "id": "period",
            "value": 20,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "day",
          "interval": 1
        }
      },
      {
        "id": "const100",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 100,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "cross_up",
        "type": "crossover",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "constNeg100",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": -100,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "crossany_neg",
        "type": "crossany",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "lt_neg100",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "down_and",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "const200",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 200,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "gt200",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "constNeg200",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": -200,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "ltNeg200",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "long_trend",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "long_mean",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "long_or",
        "type": "logical_or",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "short_trend",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "short_mean",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "short_or",
        "type": "logical_or",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "exec",
        "type": "trade_signal_executor",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      }
    ],
    "edges": [
      {
        "source": {
          "id": "src",
          "handle": "c"
        },
        "target": {
          "id": "vhf",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "vhf",
          "handle": "result"
        },
        "target": {
          "id": "trend_gt",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "thr_const",
          "handle": "result"
        },
        "target": {
          "id": "trend_gt",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "trend_gt",
          "handle": "result"
        },
        "target": {
          "id": "not_trend",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "cci",
          "handle": "result"
        },
        "target": {
          "id": "cross_up",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "const100",
          "handle": "result"
        },
        "target": {
          "id": "cross_up",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "trend_gt",
          "handle": "result"
        },
        "target": {
          "id": "long_trend",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "cross_up",
          "handle": "result"
        },
        "target": {
          "id": "long_trend",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "not_trend",
          "handle": "result"
        },
        "target": {
          "id": "long_mean",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "ltNeg200",
          "handle": "result"
        },
        "target": {
          "id": "long_mean",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "long_trend",
          "handle": "result"
        },
        "target": {
          "id": "long_or",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "long_mean",
          "handle": "result"
        },
        "target": {
          "id": "long_or",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "long_or",
          "handle": "result"
        },
        "target": {
          "id": "exec",
          "handle": "long"
        }
      },
      {
        "source": {
          "id": "cci",
          "handle": "result"
        },
        "target": {
          "id": "crossany_neg",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "constNeg100",
          "handle": "result"
        },
        "target": {
          "id": "crossany_neg",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "cci",
          "handle": "result"
        },
        "target": {
          "id": "lt_neg100",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "constNeg100",
          "handle": "result"
        },
        "target": {
          "id": "lt_neg100",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "crossany_neg",
          "handle": "result"
        },
        "target": {
          "id": "down_and",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "lt_neg100",
          "handle": "result"
        },
        "target": {
          "id": "down_and",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "trend_gt",
          "handle": "result"
        },
        "target": {
          "id": "short_trend",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "down_and",
          "handle": "result"
        },
        "target": {
          "id": "short_trend",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "cci",
          "handle": "result"
        },
        "target": {
          "id": "gt200",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "const200",
          "handle": "result"
        },
        "target": {
          "id": "gt200",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "not_trend",
          "handle": "result"
        },
        "target": {
          "id": "short_mean",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "gt200",
          "handle": "result"
        },
        "target": {
          "id": "short_mean",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "short_trend",
          "handle": "result"
        },
        "target": {
          "id": "short_or",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "short_mean",
          "handle": "result"
        },
        "target": {
          "id": "short_or",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "short_or",
          "handle": "result"
        },
        "target": {
          "id": "exec",
          "handle": "short"
        }
      },
      {
        "source": {
          "id": "cci",
          "handle": "result"
        },
        "target": {
          "id": "ltNeg200",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "constNeg200",
          "handle": "result"
        },
        "target": {
          "id": "ltNeg200",
          "handle": "*1"
        }
      }
    ]
  },
  "timestamp": "2025-06-23T15:12:46.596348",
  "tags": [
    "momentum",
    "cci",
    "technical analysis",
    "trading strategy",
    "price action"
  ]
}