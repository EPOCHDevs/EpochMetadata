{
  "id": "atr-slope-candle-pattern-reversal",
  "name": "ATR Slope Candle Pattern Reversal",
  "description": "This strategy utilizes the Average True Range (ATR) to measure market volatility and identify potential reversal points based on candle patterns. It adapts to market conditions by analyzing the slope of the ATR, ensuring optimal entry and exit points for trades.",
  "algorithm_type": "TechnicalPattern",
  "prompt": "// @version=5\nstrategy(\"ATR-Slope & Candle Pattern Adaptive Reversal Strategy\", overlay=true, max_bars_back=200)\n\n// === INPUTS ===\natr_length        = input.int(14, minval=1, title=\"ATR Length\")\nslope_length      = input.int(8, minval=2, title=\"ATR Slope Lookback\")\nmin_atr_slope     = input.float(0.03, minval=0, step=0.01, title=\"Minimum ATR Slope\")\nrisk_reward_ratio = input.float(2, minval=0.5, maxval=5, step=0.1, title=\"Reward:Risk Ratio\")\npattern_lookback  = input.int(5, minval=2, maxval=10, title=\"Candle Pattern Lookback\")\nuse_engulfing     = input.bool(true, title=\"Detect Engulfing Patterns\")\nuse_pinbar        = input.bool(true, title=\"Detect Pin Bar Patterns\")\n\n// === INDICATORS ===\natr       = ta.atr(atr_length)\natr_log   = math.log(atr)\natr_slope = ta.sma(atr_log - atr_log[slope_length], slope_length) / slope_length\n\n// === CANDLE PATTERN DETECTION ===\n// Engulfing\nbull_engulfing = use_engulfing and ta.candlecolor(1)==color.red and ta.candlecolor(0)==color.green and close > open[1] and open < close[1]\nbear_engulfing = use_engulfing and ta.candlecolor(1)==color.green and ta.candlecolor(0)==color.red and close < open[1] and open > close[1]\n// Pin Bar\npin_bar_factor = 2.0\nis_bull_pinbar = use_pinbar and (low < ta.lowest(low, pattern_lookback)[1]) and (high - close > pin_bar_factor * (open - low)) and (close > open)\nis_bear_pinbar = use_pinbar and (high > ta.highest(high, pattern_lookback)[1]) and (close - low > pin_bar_factor * (high - close)) and (close < open)\n// Combined signals\nbull_signal = (bull_engulfing or is_bull_pinbar)\nbear_signal = (bear_engulfing or is_bear_pinbar)\n\n// === ATR SLOPE FILTER ===\nbull_confirm = bull_signal and atr_slope < -min_atr_slope // Volatility contraction\nbear_confirm = bear_signal and atr_slope > min_atr_slope  // Volatility expansion\n\n// === ORDER LOGIC ===\nif bull_confirm\n    stop_loss = low - atr\n    take_profit = close + (close - stop_loss) * risk_reward_ratio\n    strategy.entry(\"LongReversal\", strategy.long, stop=close, when=not na(stop_loss))\n    strategy.exit(\"LongTP/SL\", \"LongReversal\", stop=stop_loss, limit=take_profit)\n\nif bear_confirm\n    stop_loss = high + atr\n    take_profit = close - (stop_loss - close) * risk_reward_ratio\n    strategy.entry(\"ShortReversal\", strategy.short, stop=close, when=not na(stop_loss))\n    strategy.exit(\"ShortTP/SL\", \"ShortReversal\", stop=stop_loss, limit=take_profit)\n\n// === PLOTTING ===\nplot(atr, color=color.purple, title=\"ATR\")\nplot(atr_slope, color=color.blue, title=\"ATR Slope\", linewidth=2)\nplotshape(bull_confirm, title=\"Bullish Signal\", location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small)\nplotshape(bear_confirm, title=\"Bearish Signal\", location=location.abovebar, color=color.red, style=shape.triangledown, size=size.small)",
  "blueprint": {
    "nodes": [
      {
        "id": "atr1",
        "type": "atr",
        "options": [
          {
            "id": "period",
            "value": 14,
            "name": "ATR Length",
            "isExposed": true
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "day",
          "interval": 1
        }
      },
      {
        "id": "ln1",
        "type": "ln",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "lag1",
        "type": "lag",
        "options": [
          {
            "id": "period",
            "value": 8,
            "name": "Slope Lookback",
            "isExposed": true
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "sub1",
        "type": "sub",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "sma1",
        "type": "sma",
        "options": [
          {
            "id": "period",
            "value": 8,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "div1",
        "type": "div",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "const_slen",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 8,
            "name": "Slope Length",
            "isExposed": true
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "const_min",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 0.03,
            "name": "Min ATR Slope",
            "isExposed": true
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "const_negmin",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": -0.03,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "gt1",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "lt1",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "eng_bull1",
        "type": "engulfing_bull",
        "options": [
          {
            "id": "period",
            "value": 10,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_none",
            "value": 0.05,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_short",
            "value": 0.5,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_long",
            "value": 1.4,
            "name": "",
            "isExposed": false
          },
          {
            "id": "wick_none",
            "value": 0.05,
            "name": "",
            "isExposed": false
          },
          {
            "id": "wick_long",
            "value": 0.6,
            "name": "",
            "isExposed": false
          },
          {
            "id": "near",
            "value": 0.3,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "day",
          "interval": 1
        }
      },
      {
        "id": "hammer1",
        "type": "hammer",
        "options": [
          {
            "id": "period",
            "value": 10,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_none",
            "value": 0.05,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_short",
            "value": 0.5,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_long",
            "value": 1.4,
            "name": "",
            "isExposed": false
          },
          {
            "id": "wick_none",
            "value": 0.05,
            "name": "",
            "isExposed": false
          },
          {
            "id": "wick_long",
            "value": 0.6,
            "name": "",
            "isExposed": false
          },
          {
            "id": "near",
            "value": 0.3,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "day",
          "interval": 1
        }
      },
      {
        "id": "or_bull1",
        "type": "logical_or",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "and_bull1",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "eng_bear1",
        "type": "engulfing_bear",
        "options": [
          {
            "id": "period",
            "value": 10,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_none",
            "value": 0.05,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_short",
            "value": 0.5,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_long",
            "value": 1.4,
            "name": "",
            "isExposed": false
          },
          {
            "id": "wick_none",
            "value": 0.05,
            "name": "",
            "isExposed": false
          },
          {
            "id": "wick_long",
            "value": 0.6,
            "name": "",
            "isExposed": false
          },
          {
            "id": "near",
            "value": 0.3,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "day",
          "interval": 1
        }
      },
      {
        "id": "hang1",
        "type": "hanging_man",
        "options": [
          {
            "id": "period",
            "value": 10,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_none",
            "value": 0.05,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_short",
            "value": 0.5,
            "name": "",
            "isExposed": false
          },
          {
            "id": "body_long",
            "value": 1.4,
            "name": "",
            "isExposed": false
          },
          {
            "id": "wick_none",
            "value": 0.05,
            "name": "",
            "isExposed": false
          },
          {
            "id": "wick_long",
            "value": 0.6,
            "name": "",
            "isExposed": false
          },
          {
            "id": "near",
            "value": 0.3,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "day",
          "interval": 1
        }
      },
      {
        "id": "or_bear1",
        "type": "logical_or",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "and_bear1",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "exec1",
        "type": "trade_signal_executor",
        "options": [
          {
            "id": "closeIfIndecisive",
            "value": false,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      }
    ],
    "edges": [
      {
        "source": {
          "id": "atr1",
          "handle": "result"
        },
        "target": {
          "id": "ln1",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "ln1",
          "handle": "result"
        },
        "target": {
          "id": "lag1",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "ln1",
          "handle": "result"
        },
        "target": {
          "id": "sub1",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "lag1",
          "handle": "result"
        },
        "target": {
          "id": "sub1",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "sub1",
          "handle": "result"
        },
        "target": {
          "id": "sma1",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "sma1",
          "handle": "result"
        },
        "target": {
          "id": "div1",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "const_slen",
          "handle": "result"
        },
        "target": {
          "id": "div1",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "div1",
          "handle": "result"
        },
        "target": {
          "id": "gt1",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "const_min",
          "handle": "result"
        },
        "target": {
          "id": "gt1",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "div1",
          "handle": "result"
        },
        "target": {
          "id": "lt1",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "const_negmin",
          "handle": "result"
        },
        "target": {
          "id": "lt1",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "eng_bull1",
          "handle": "result"
        },
        "target": {
          "id": "or_bull1",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "hammer1",
          "handle": "result"
        },
        "target": {
          "id": "or_bull1",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "or_bull1",
          "handle": "result"
        },
        "target": {
          "id": "and_bull1",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "lt1",
          "handle": "result"
        },
        "target": {
          "id": "and_bull1",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "eng_bear1",
          "handle": "result"
        },
        "target": {
          "id": "or_bear1",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "hang1",
          "handle": "result"
        },
        "target": {
          "id": "or_bear1",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "or_bear1",
          "handle": "result"
        },
        "target": {
          "id": "and_bear1",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "gt1",
          "handle": "result"
        },
        "target": {
          "id": "and_bear1",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "and_bull1",
          "handle": "result"
        },
        "target": {
          "id": "exec1",
          "handle": "long"
        }
      },
      {
        "source": {
          "id": "and_bear1",
          "handle": "result"
        },
        "target": {
          "id": "exec1",
          "handle": "short"
        }
      }
    ]
  },
  "timestamp": "2025-06-23T14:56:58.450191",
  "tags": [
    "ATR",
    "Candle Patterns",
    "Reversal Strategy",
    "Technical Analysis",
    "Volatility"
  ]
}