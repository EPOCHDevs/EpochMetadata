{
  "id": "algorithm_93",
  "name": "VWAP Fractal Reversion Strategy",
  "description": "This strategy combines the VWAP indicator with a fractal channel to identify potential reversal points in the market. It uses a defined fractal window and VWAP lookback period to generate entry signals, while incorporating a price channel buffer and take profit percentage for risk management.",
  "algorithm_type": "TechnicalPattern",
  "prompt": "// @version=5\nstrategy(\"VWAP & Fractal Channel Reversion Strategy\", overlay=true, max_bars_back=100)\n\n// === Inputs ===\nfractal_len = input.int(5, minval=2, title=\"Fractal Window Length\")\nvwap_lookback = input.int(50, minval=5, title=\"VWAP Window\")\nentry_buffer = input.float(0.5, title=\"Price Channel Buffer %\", minval=0.0, maxval=2.0) / 100\ntake_profit_pct = input.float(1.5, title=\"Take Profit %\", minval=0.2, maxval=10) / 100\nstop_loss_pct = input.float(0.7, title=\"Stop Loss %\", minval=0.1, maxval=5) / 100\n\n// === Dynamic VWAP (windowed) ===\ncum_pv = math.sum(close * volume, vwap_lookback)\ncum_vol = math.sum(volume, vwap_lookback)\nvwap = cum_vol == 0 ? na : cum_pv / cum_vol\nplot(vwap, color=color.new(color.purple, 0), title=\"Windowed VWAP\")\n\n// === Fractal Channel (local min/max) ===\nfhi = ta.highest(high, fractal_len)\nflo = ta.lowest(low, fractal_len)\nchannel_top = fhi\nchannel_bot = flo\nchannel_buffer = (channel_top - channel_bot) * entry_buffer\n\nplot(channel_top, color=color.new(color.teal, 0), linewidth=1, title=\"Fractal Channel High\")\nplot(channel_bot, color=color.new(color.orange, 0), linewidth=1, title=\"Fractal Channel Low\")\n\n// === Entry Signals: Mean Reversion Toward VWAP at Channel Extremes ===\nbull_reversal = low <= (channel_bot + channel_buffer) and close > vwap and close[1] < vwap[1]\nbear_reversal = high >= (channel_top - channel_buffer) and close < vwap and close[1] > vwap[1]\n\n// === Exits ===\nlong_take = strategy.position_avg_price * (1 + take_profit_pct)\nlong_stop = strategy.position_avg_price * (1 - stop_loss_pct)\nshort_take = strategy.position_avg_price * (1 - take_profit_pct)\nshort_stop = strategy.position_avg_price * (1 + stop_loss_pct)\n\n// === Execute Trades ===\nif bull_reversal and strategy.position_size == 0\n    strategy.entry(\"Long FracRev\", strategy.long, comment=\"Long on Channel+VWAP Mean Reversion\")\n    strategy.exit(\"TP/SL Long\", from_entry=\"Long FracRev\", limit=long_take, stop=long_stop)\n\nif bear_reversal and strategy.position_size == 0\n    strategy.entry(\"Short FracRev\", strategy.short, comment=\"Short on Channel+VWAP Mean Reversion\")\n    strategy.exit(\"TP/SL Short\", from_entry=\"Short FracRev\", limit=short_take, stop=short_stop)\n\n\n// === Visual Enhancements ===\nbgcolor(bull_reversal ? color.new(color.green, 88) : na)\nbgcolor(bear_reversal ? color.new(color.red, 88) : na)\n\n// Fractal channel fill\nfill(plot(channel_top, display=display.none), plot(channel_bot, display=display.none), color=color.new(color.gray, 92))",
  "blueprint": {
    "nodes": [
      {
        "id": "src",
        "type": "market_data_source",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "minute",
          "interval": 1
        }
      },
      {
        "id": "mul_pv",
        "type": "mul",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "sum_pv",
        "type": "sum",
        "options": [
          {
            "id": "period",
            "value": 50,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "sum_vol",
        "type": "sum",
        "options": [
          {
            "id": "period",
            "value": 50,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "vwap",
        "type": "div",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "hi_fractal",
        "type": "max",
        "options": [
          {
            "id": "period",
            "value": 5,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "lo_fractal",
        "type": "min",
        "options": [
          {
            "id": "period",
            "value": 5,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "channel_width",
        "type": "sub",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "buffer_pct",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 0.005,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "buffer_value",
        "type": "mul",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "bot_plus_buf",
        "type": "add",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "top_minus_buf",
        "type": "sub",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "cond_low",
        "type": "lte",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "cond_high",
        "type": "gte",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "cross_up",
        "type": "crossover",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "cross_down",
        "type": "crossover",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "bull_signal",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "bear_signal",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "executor",
        "type": "trade_signal_executor",
        "options": [
          {
            "id": "closeIfIndecisive",
            "value": false,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      }
    ],
    "edges": [
      {
        "source": {
          "id": "src",
          "handle": "c"
        },
        "target": {
          "id": "mul_pv",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "src",
          "handle": "v"
        },
        "target": {
          "id": "mul_pv",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "mul_pv",
          "handle": "result"
        },
        "target": {
          "id": "sum_pv",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "src",
          "handle": "v"
        },
        "target": {
          "id": "sum_vol",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "sum_pv",
          "handle": "result"
        },
        "target": {
          "id": "vwap",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "sum_vol",
          "handle": "result"
        },
        "target": {
          "id": "vwap",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "src",
          "handle": "h"
        },
        "target": {
          "id": "hi_fractal",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "src",
          "handle": "l"
        },
        "target": {
          "id": "lo_fractal",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "hi_fractal",
          "handle": "result"
        },
        "target": {
          "id": "channel_width",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "lo_fractal",
          "handle": "result"
        },
        "target": {
          "id": "channel_width",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "channel_width",
          "handle": "result"
        },
        "target": {
          "id": "buffer_value",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "buffer_pct",
          "handle": "result"
        },
        "target": {
          "id": "buffer_value",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "lo_fractal",
          "handle": "result"
        },
        "target": {
          "id": "bot_plus_buf",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "buffer_value",
          "handle": "result"
        },
        "target": {
          "id": "bot_plus_buf",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "hi_fractal",
          "handle": "result"
        },
        "target": {
          "id": "top_minus_buf",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "buffer_value",
          "handle": "result"
        },
        "target": {
          "id": "top_minus_buf",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "src",
          "handle": "l"
        },
        "target": {
          "id": "cond_low",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "bot_plus_buf",
          "handle": "result"
        },
        "target": {
          "id": "cond_low",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "src",
          "handle": "h"
        },
        "target": {
          "id": "cond_high",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "top_minus_buf",
          "handle": "result"
        },
        "target": {
          "id": "cond_high",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "src",
          "handle": "c"
        },
        "target": {
          "id": "cross_up",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "vwap",
          "handle": "result"
        },
        "target": {
          "id": "cross_up",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "vwap",
          "handle": "result"
        },
        "target": {
          "id": "cross_down",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "src",
          "handle": "c"
        },
        "target": {
          "id": "cross_down",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "cond_low",
          "handle": "result"
        },
        "target": {
          "id": "bull_signal",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "cross_up",
          "handle": "result"
        },
        "target": {
          "id": "bull_signal",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "cond_high",
          "handle": "result"
        },
        "target": {
          "id": "bear_signal",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "cross_down",
          "handle": "result"
        },
        "target": {
          "id": "bear_signal",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "bull_signal",
          "handle": "result"
        },
        "target": {
          "id": "executor",
          "handle": "long"
        }
      },
      {
        "source": {
          "id": "bear_signal",
          "handle": "result"
        },
        "target": {
          "id": "executor",
          "handle": "short"
        }
      }
    ]
  },
  "timestamp": "2025-06-23T15:48:24.993529",
  "tags": [
    "VWAP",
    "Fractal",
    "Reversion",
    "TechnicalPattern",
    "TradingStrategy"
  ]
}