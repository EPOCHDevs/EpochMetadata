{
  "id": "algorithm_trendfollowing_001",
  "name": "Adaptive Hurst Trend Strategy",
  "description": "This strategy utilizes an adaptive Hurst exponent to identify market trends and switches regimes based on volatility. It incorporates a volume spike filter to enhance trade signals, aiming to improve entry and exit points in trending markets.",
  "algorithm_type": "TrendFollowing",
  "prompt": "import pandas as pd\nimport numpy as np\n\ndef trading_strategy(data):\n    # Adaptive Hurst-Volatility Regime Switcher with Volume Spike Filter\n    \n    # Calculate Hurst exponent over rolling windows\n    def rolling_hurst(prices, window):\n        def hurst(ts):\n            lags = range(2, 20)\n            tau = [np.std(np.subtract(ts[lag:], ts[:-lag])) for lag in lags]\n            poly = np.polyfit(np.log(lags), np.log(tau), 1)\n            return poly[0]*2.0\n        return prices.rolling(window).apply(hurst, raw=False)\n    \n    data['hurst_50'] = rolling_hurst(data['close'], 50)\n    \n    # Calculate historical volatility (rolling standard deviation)\n    data['vol_20'] = data['close'].pct_change().rolling(20).std()\n    \n    # Calculate Relative Volume Spike (current volume vs 20ma)\n    data['rel_vol'] = data['volume'] / data['volume'].rolling(20).mean()\n    \n    # Regime logic\n    # Hurst > 0.55: Trending regime\n    # Hurst < 0.45: Mean-reverting regime\n    data['regime'] = np.where(data['hurst_50'] > 0.55, 'trend',\n                      np.where(data['hurst_50'] < 0.45, 'meanrev', 'neutral'))\n    \n    # Trading logic:\n    data['signal'] = 0\n    \n    # 1. Trend-following in trending regime using Donchian Channel breakout, but require volume spike\n    dc_high = data['high'].rolling(21).max()\n    dc_low = data['low'].rolling(21).min()\n    breakout_long = (data['close'] > dc_high.shift(1)) & (data['regime'] == 'trend') & (data['rel_vol'] > 1.5)\n    breakout_short = (data['close'] < dc_low.shift(1)) & (data['regime'] == 'trend') & (data['rel_vol'] > 1.5)\n    \n    # 2. Mean-reversion in mean-reverting regime using Bollinger Bands, but only if volatility is low\n    ma_20 = data['close'].rolling(20).mean()\n    bb_std = data['close'].rolling(20).std()\n    upper_bb = ma_20 + 2 * bb_std\n    lower_bb = ma_20 - 2 * bb_std\n    meanrev_long = (data['close'] < lower_bb) & (data['regime'] == 'meanrev') & (data['vol_20'] < 0.025)\n    meanrev_short = (data['close'] > upper_bb) & (data['regime'] == 'meanrev') & (data['vol_20'] < 0.025)\n    \n    # 3. No position in neutral regime\n    data.loc[breakout_long, 'signal'] = 1\n    data.loc[breakout_short, 'signal'] = -1\n    data.loc[meanrev_long, 'signal'] = 1\n    data.loc[meanrev_short, 'signal'] = -1\n    \n    # Optional: Hold position for at least 3 bars\n    data['signal'] = data['signal'].replace(0, np.nan)\n    data['signal'] = data['signal'].ffill(limit=2).fillna(0)\n    \n    return data",
  "blueprint": {
    "nodes": [
      {
        "id": "n1",
        "type": "market_data_source",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "day",
          "interval": 1
        }
      },
      {
        "id": "n2",
        "type": "sma",
        "options": [
          {
            "id": "period",
            "value": 20,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n3",
        "type": "div",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n4",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 1.5,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n5",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n6",
        "type": "rolling_hurst_exponent",
        "options": [
          {
            "id": "window",
            "value": 50,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n7",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 0.55,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n8",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n9",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 0.45,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n10",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n11",
        "type": "stddev",
        "options": [
          {
            "id": "period",
            "value": 20,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n12",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 0.025,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n13",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n14",
        "type": "bbands",
        "options": [
          {
            "id": "period",
            "value": 20,
            "name": "",
            "isExposed": false
          },
          {
            "id": "stddev",
            "value": 2,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n15",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n16",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n17",
        "type": "max",
        "options": [
          {
            "id": "period",
            "value": 21,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n18",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n19",
        "type": "min",
        "options": [
          {
            "id": "period",
            "value": 21,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n20",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n21",
        "type": "agg_all_of",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n22",
        "type": "agg_all_of",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n23",
        "type": "agg_all_of",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n24",
        "type": "agg_all_of",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n25",
        "type": "agg_any_of",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n26",
        "type": "agg_any_of",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "n27",
        "type": "trade_signal_executor",
        "options": [
          {
            "id": "closeIfIndecisive",
            "value": false,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      }
    ],
    "edges": [
      {
        "source": {
          "id": "n1",
          "handle": "v"
        },
        "target": {
          "id": "n2",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n1",
          "handle": "v"
        },
        "target": {
          "id": "n3",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "n2",
          "handle": "result"
        },
        "target": {
          "id": "n3",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "n3",
          "handle": "result"
        },
        "target": {
          "id": "n5",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "n4",
          "handle": "result"
        },
        "target": {
          "id": "n5",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "n1",
          "handle": "c"
        },
        "target": {
          "id": "n6",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n6",
          "handle": "result"
        },
        "target": {
          "id": "n8",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "n7",
          "handle": "result"
        },
        "target": {
          "id": "n8",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "n6",
          "handle": "result"
        },
        "target": {
          "id": "n10",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "n9",
          "handle": "result"
        },
        "target": {
          "id": "n10",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "n1",
          "handle": "c"
        },
        "target": {
          "id": "n11",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n11",
          "handle": "result"
        },
        "target": {
          "id": "n13",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "n12",
          "handle": "result"
        },
        "target": {
          "id": "n13",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "n1",
          "handle": "c"
        },
        "target": {
          "id": "n14",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n1",
          "handle": "c"
        },
        "target": {
          "id": "n15",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "n14",
          "handle": "bbands_lower"
        },
        "target": {
          "id": "n15",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "n1",
          "handle": "c"
        },
        "target": {
          "id": "n16",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "n14",
          "handle": "bbands_upper"
        },
        "target": {
          "id": "n16",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "n1",
          "handle": "h"
        },
        "target": {
          "id": "n17",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n1",
          "handle": "c"
        },
        "target": {
          "id": "n18",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "n17",
          "handle": "result"
        },
        "target": {
          "id": "n18",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "n1",
          "handle": "l"
        },
        "target": {
          "id": "n19",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n1",
          "handle": "c"
        },
        "target": {
          "id": "n20",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "n19",
          "handle": "result"
        },
        "target": {
          "id": "n20",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "n8",
          "handle": "result"
        },
        "target": {
          "id": "n21",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n5",
          "handle": "result"
        },
        "target": {
          "id": "n21",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n18",
          "handle": "result"
        },
        "target": {
          "id": "n21",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n8",
          "handle": "result"
        },
        "target": {
          "id": "n22",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n5",
          "handle": "result"
        },
        "target": {
          "id": "n22",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n20",
          "handle": "result"
        },
        "target": {
          "id": "n22",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n10",
          "handle": "result"
        },
        "target": {
          "id": "n23",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n13",
          "handle": "result"
        },
        "target": {
          "id": "n23",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n15",
          "handle": "result"
        },
        "target": {
          "id": "n23",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n10",
          "handle": "result"
        },
        "target": {
          "id": "n24",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n13",
          "handle": "result"
        },
        "target": {
          "id": "n24",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n16",
          "handle": "result"
        },
        "target": {
          "id": "n24",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n21",
          "handle": "result"
        },
        "target": {
          "id": "n25",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n23",
          "handle": "result"
        },
        "target": {
          "id": "n25",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n22",
          "handle": "result"
        },
        "target": {
          "id": "n26",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n24",
          "handle": "result"
        },
        "target": {
          "id": "n26",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "n25",
          "handle": "result"
        },
        "target": {
          "id": "n27",
          "handle": "long"
        }
      },
      {
        "source": {
          "id": "n26",
          "handle": "result"
        },
        "target": {
          "id": "n27",
          "handle": "short"
        }
      }
    ]
  },
  "timestamp": "2025-06-23T15:16:01.427930",
  "tags": [
    "trend following",
    "Hurst exponent",
    "volatility",
    "volume filter",
    "adaptive strategy"
  ]
}