{
  "id": "volume_weighted_macd_rsi_filter",
  "name": "Volume-Weighted MACD with RSI Filter",
  "description": "This strategy utilizes a Volume-Weighted MACD (VW-MACD) combined with a dynamically adjusted RSI filter based on Average True Range (ATR) to generate buy and sell signals. The VW-MACD is calculated using volume-weighted closing prices, enhancing the sensitivity of the MACD to trading volume fluctuations.",
  "algorithm_type": "TechnicalPattern",
  "prompt": "import pandas as pd\nimport numpy as np\nimport talib\n\ndef volume_weighted_macd_strategy(data):\n    \"\"\"\n    Strategy Concept:\n    Combines a Volume-Weighted MACD (VW-MACD) with a Volatility-Filtered RSI to generate buy/sell signals.\n    \n    Unique elements:\n    - VW-MACD: MACD calculated on volume-weighted close prices.\n    - RSI filter adjusted dynamically based on Average True Range (ATR) volatility.\n    - Entry only triggered when MACD crosses over zero line AND RSI moves out of oversold/overbought bands dynamically adjusted by volatility.\n    \n    Parameters:\n      data: DataFrame with columns ['open', 'high', 'low', 'close', 'volume']\n      \n    Returns:\n      DataFrame with added columns 'signal' : 1 for buy, -1 for sell, 0 for hold\n    \"\"\"\n    price = data['close']\n    volume = data['volume']\n\n    # Volume weighted close\n    vw_close = (price * volume).cumsum() / volume.cumsum()\n    vw_close.fillna(price, inplace=True)\n    \n    # Calculate MACD on volume weighted close price\n    macd, macdsignal, macdhist = talib.MACD(vw_close.values, fastperiod=12, slowperiod=26, signalperiod=9)\n    data['vw_macd'] = macd\n    data['vw_macd_signal'] = macdsignal\n\n    # Calculate ATR for volatility filtering\n    atr = talib.ATR(data['high'], data['low'], data['close'], timeperiod=14)\n    \n    # Dynamic RSI oversold/overbought thresholds based on ATR scaled to price (~percent of close)\n    atr_pct = atr / price * 100\n    rsi_oversold = 30 - atr_pct * 0.5\n    rsi_overbought = 70 + atr_pct * 0.5\n    \n    # Clamp thresholds\n    rsi_oversold = np.clip(rsi_oversold, 10, 40)\n    rsi_overbought = np.clip(rsi_overbought, 60, 90)\n    \n    # Calculate RSI normally on close price\n    rsi = talib.RSI(price.values, timeperiod=14)\n    data['rsi'] = rsi\n    \n    data['rsi_oversold'] = rsi_oversold\n    data['rsi_overbought'] = rsi_overbought\n    \n    # Generate signals\n    data['signal'] = 0\n\n    # Buy signal:\n    # 1. VW-MACD crosses above zero line\n    # 2. RSI crosses above dynamic oversold level\n    cond_macd_cross_zero = (data['vw_macd'].shift(1) < 0) & (data['vw_macd'] > 0)\n    cond_rsi_cross_oversold = (data['rsi'].shift(1) < data['rsi_oversold'].shift(1)) & (data['rsi'] > data['rsi_oversold'])\n    buy_condition = cond_macd_cross_zero & cond_rsi_cross_oversold\n\n    # Sell signal:\n    # 1. VW-MACD crosses below zero line\n    # 2. RSI crosses below dynamic overbought level\n    cond_macd_cross_zero_down = (data['vw_macd'].shift(1) > 0) & (data['vw_macd'] < 0)\n    cond_rsi_cross_overbought = (data['rsi'].shift(1) > data['rsi_overbought'].shift(1)) & (data['rsi'] < data['rsi_overbought'])\n    sell_condition = cond_macd_cross_zero_down & cond_rsi_cross_overbought\n\n    data.loc[buy_condition, 'signal'] = 1\n    data.loc[sell_condition, 'signal'] = -1\n\n    return data",
  "blueprint": {
    "nodes": [
      {
        "id": "src",
        "type": "market_data_source",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "day",
          "interval": 1
        }
      },
      {
        "id": "macd1",
        "type": "macd",
        "options": [
          {
            "id": "short_period",
            "value": 12,
            "name": "",
            "isExposed": false
          },
          {
            "id": "long_period",
            "value": 26,
            "name": "",
            "isExposed": false
          },
          {
            "id": "signal_period",
            "value": 9,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "rsi1",
        "type": "rsi",
        "options": [
          {
            "id": "period",
            "value": 14,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "zeroConst",
        "type": "zero",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "num30",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 30,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "num70",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 70,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "gtMacdPos",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "ltMacdNeg",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "oversold",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "overbought",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "longAND",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "shortAND",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "executor",
        "type": "trade_signal_executor",
        "options": [
          {
            "id": "closeIfIndecisive",
            "value": false,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      }
    ],
    "edges": [
      {
        "source": {
          "id": "src",
          "handle": "c"
        },
        "target": {
          "id": "macd1",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "src",
          "handle": "c"
        },
        "target": {
          "id": "rsi1",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "macd1",
          "handle": "macd"
        },
        "target": {
          "id": "gtMacdPos",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "zeroConst",
          "handle": "result"
        },
        "target": {
          "id": "gtMacdPos",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "macd1",
          "handle": "macd"
        },
        "target": {
          "id": "ltMacdNeg",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "zeroConst",
          "handle": "result"
        },
        "target": {
          "id": "ltMacdNeg",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "rsi1",
          "handle": "result"
        },
        "target": {
          "id": "oversold",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "num30",
          "handle": "result"
        },
        "target": {
          "id": "oversold",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "rsi1",
          "handle": "result"
        },
        "target": {
          "id": "overbought",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "num70",
          "handle": "result"
        },
        "target": {
          "id": "overbought",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "oversold",
          "handle": "result"
        },
        "target": {
          "id": "longAND",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "gtMacdPos",
          "handle": "result"
        },
        "target": {
          "id": "longAND",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "overbought",
          "handle": "result"
        },
        "target": {
          "id": "shortAND",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "ltMacdNeg",
          "handle": "result"
        },
        "target": {
          "id": "shortAND",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "longAND",
          "handle": "result"
        },
        "target": {
          "id": "executor",
          "handle": "long"
        }
      },
      {
        "source": {
          "id": "shortAND",
          "handle": "result"
        },
        "target": {
          "id": "executor",
          "handle": "short"
        }
      }
    ]
  },
  "timestamp": "2025-06-23T15:16:15.393239",
  "tags": [
    "technical",
    "macd",
    "rsi",
    "volume",
    "strategy"
  ]
}