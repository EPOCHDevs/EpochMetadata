{
  "id": "volatility_adaptive_chandelier_atr",
  "name": "Volatility Adaptive Chandelier ATR",
  "description": "This trading strategy adapts to varying volatility regimes by utilizing a 21-day rolling historical volatility measure. In high volatility periods, it employs a Chandelier Exit based on the Average True Range (ATR), while in low volatility, it seeks contrarian swing entries near the Chandelier bands.",
  "algorithm_type": "TechnicalPattern",
  "prompt": "import pandas as pd\nimport numpy as np\n\ndef trading_strategy(data):\n    \"\"\"\n    Strategy: Multi-Volatility Regime Adaptive Chandelier ATR Swing\n\n    Concept:\n    - Detects high and low volatility regimes using 21-day rolling historical volatility.\n    - In high volatility, follows trend using Chandelier Exit on ATR.\n    - In low volatility, contrarian swing entries near Chandelier bands.\n    - Entry/exit signals adapt dynamically to volatility and use both price and volume changes.\n\n    Signal output:\n    data['signal'] = 1 for long, -1 for short, 0 for neutral\n    \"\"\"\n    data = data.copy()\n    # Calculate rolling annualized volatility (using log returns)\n    log_ret = np.log(data['close'] / data['close'].shift(1))\n    data['volatility'] = log_ret.rolling(window=21).std() * np.sqrt(252)\n\n    # 21-period ATR\n    high_low = data['high'] - data['low']\n    high_close = np.abs(data['high'] - data['close'].shift(1))\n    low_close = np.abs(data['low'] - data['close'].shift(1))\n    tr = pd.concat([high_low, high_close, low_close], axis=1).max(axis=1)\n    data['ATR'] = tr.rolling(window=21).mean()\n\n    # Chandelier Exit (long/short) - using ATR\n    chand_long = data['high'].rolling(window=21).max() - data['ATR'] * 3\n    chand_short = data['low'].rolling(window=21).min() + data['ATR'] * 3\n\n    # Rate of Change in Volume - indicates volume surge/decay\n    data['vol_roc'] = data['volume'].pct_change(periods=5)\n\n    # Percentile bands for volatility regime\n    vol_70 = data['volatility'].rolling(window=63).quantile(0.7)\n    vol_30 = data['volatility'].rolling(window=63).quantile(0.3)\n    # Regime flag: High = 1, Low = -1, Mid = 0\n    data['regime'] = 0\n    data.loc[data['volatility'] >= vol_70, 'regime'] = 1\n    data.loc[data['volatility'] <= vol_30, 'regime'] = -1\n\n    data['signal'] = 0\n\n    # High Volatility: trend-follow using Chandelier Exit and price/vol confirmation\n    long_cond = (\n        (data['regime'] == 1) &\n        (data['close'] > chand_long) &\n        (data['close'].shift(1) <= chand_long.shift(1)) &\n        (data['vol_roc'] > 0.2)\n    )\n    short_cond = (\n        (data['regime'] == 1) &\n        (data['close'] < chand_short) &\n        (data['close'].shift(1) >= chand_short.shift(1)) &\n        (data['vol_roc'] < -0.2)\n    )\n    data.loc[long_cond, 'signal'] = 1\n    data.loc[short_cond, 'signal'] = -1\n\n    # Low Volatility: mean reversion swing at Chandelier bands, fade breakouts\n    fade_long = (\n        (data['regime'] == -1) &\n        (data['close'] < chand_short * 1.01) &\n        (data['vol_roc'] < -0.1)\n    )\n    fade_short = (\n        (data['regime'] == -1) &\n        (data['close'] > chand_long * 0.99) &\n        (data['vol_roc'] > 0.1)\n    )\n    data.loc[fade_long, 'signal'] = 1\n    data.loc[fade_short, 'signal'] = -1\n\n    # De-dupe consecutive identical signals for cleaner outputs\n    data['signal'] = data['signal'].where(data['signal'] != data['signal'].shift(1), 0)\n\n    return data",
  "blueprint": {
    "nodes": [
      {
        "id": "mkt",
        "type": "market_data_source",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "day",
          "interval": 1
        }
      },
      {
        "id": "vol",
        "type": "volatility",
        "options": [
          {
            "id": "period",
            "value": 21,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "atr",
        "type": "atr",
        "options": [
          {
            "id": "period",
            "value": 21,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "day",
          "interval": 1
        }
      },
      {
        "id": "maxH",
        "type": "max",
        "options": [
          {
            "id": "period",
            "value": 21,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "minL",
        "type": "min",
        "options": [
          {
            "id": "period",
            "value": 21,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "num3",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 3,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "mulAtr",
        "type": "mul",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "longLine",
        "type": "sub",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "shortLine",
        "type": "add",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "numHigh",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 0.03,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "numLow",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 0.015,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "gtHigh",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "ltLow",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "crossLong",
        "type": "crossover",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "crossShort",
        "type": "crossover",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "andHVLong",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "andHVShort",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "ltCloseShort",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "gtCloseLong",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "andLVLong",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "andLVShort",
        "type": "logical_and",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "longAny",
        "type": "agg_any_of",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "shortAny",
        "type": "agg_any_of",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "exec",
        "type": "trade_signal_executor",
        "options": [
          {
            "id": "closeIfIndecisive",
            "value": false,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      }
    ],
    "edges": [
      {
        "source": {
          "id": "mkt",
          "handle": "c"
        },
        "target": {
          "id": "vol",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "vol",
          "handle": "result"
        },
        "target": {
          "id": "gtHigh",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "numHigh",
          "handle": "result"
        },
        "target": {
          "id": "gtHigh",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "vol",
          "handle": "result"
        },
        "target": {
          "id": "ltLow",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "numLow",
          "handle": "result"
        },
        "target": {
          "id": "ltLow",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "mkt",
          "handle": "h"
        },
        "target": {
          "id": "maxH",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "mkt",
          "handle": "l"
        },
        "target": {
          "id": "minL",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "atr",
          "handle": "result"
        },
        "target": {
          "id": "mulAtr",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "num3",
          "handle": "result"
        },
        "target": {
          "id": "mulAtr",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "maxH",
          "handle": "result"
        },
        "target": {
          "id": "longLine",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "mulAtr",
          "handle": "result"
        },
        "target": {
          "id": "longLine",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "minL",
          "handle": "result"
        },
        "target": {
          "id": "shortLine",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "mulAtr",
          "handle": "result"
        },
        "target": {
          "id": "shortLine",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "mkt",
          "handle": "c"
        },
        "target": {
          "id": "crossLong",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "longLine",
          "handle": "result"
        },
        "target": {
          "id": "crossLong",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "shortLine",
          "handle": "result"
        },
        "target": {
          "id": "crossShort",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "mkt",
          "handle": "c"
        },
        "target": {
          "id": "crossShort",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "gtHigh",
          "handle": "result"
        },
        "target": {
          "id": "andHVLong",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "crossLong",
          "handle": "result"
        },
        "target": {
          "id": "andHVLong",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "gtHigh",
          "handle": "result"
        },
        "target": {
          "id": "andHVShort",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "crossShort",
          "handle": "result"
        },
        "target": {
          "id": "andHVShort",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "mkt",
          "handle": "c"
        },
        "target": {
          "id": "ltCloseShort",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "shortLine",
          "handle": "result"
        },
        "target": {
          "id": "ltCloseShort",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "ltLow",
          "handle": "result"
        },
        "target": {
          "id": "andLVLong",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "ltCloseShort",
          "handle": "result"
        },
        "target": {
          "id": "andLVLong",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "mkt",
          "handle": "c"
        },
        "target": {
          "id": "gtCloseLong",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "longLine",
          "handle": "result"
        },
        "target": {
          "id": "gtCloseLong",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "ltLow",
          "handle": "result"
        },
        "target": {
          "id": "andLVShort",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "gtCloseLong",
          "handle": "result"
        },
        "target": {
          "id": "andLVShort",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "andHVLong",
          "handle": "result"
        },
        "target": {
          "id": "longAny",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "andLVLong",
          "handle": "result"
        },
        "target": {
          "id": "longAny",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "andHVShort",
          "handle": "result"
        },
        "target": {
          "id": "shortAny",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "andLVShort",
          "handle": "result"
        },
        "target": {
          "id": "shortAny",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "longAny",
          "handle": "result"
        },
        "target": {
          "id": "exec",
          "handle": "long"
        }
      },
      {
        "source": {
          "id": "shortAny",
          "handle": "result"
        },
        "target": {
          "id": "exec",
          "handle": "short"
        }
      }
    ]
  },
  "timestamp": "2025-06-23T15:37:18.959421",
  "tags": [
    "trading",
    "strategy",
    "volatility",
    "ATR",
    "technical"
  ]
}