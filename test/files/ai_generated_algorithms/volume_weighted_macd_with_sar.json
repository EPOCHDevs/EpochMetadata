{
  "id": "algorithm_001",
  "name": "Volume-Weighted MACD with SAR",
  "description": "This trading strategy combines Volume-Weighted MACD divergence with a Parabolic SAR trend filter and detects sudden volume surges. It aims to buy during bullish signals and sell/short during bearish signals, optimizing trade entries and exits based on volume dynamics.",
  "algorithm_type": "TechnicalPattern",
  "prompt": "import pandas as pd\nimport numpy as np\n\ndef trading_strategy(data):\n    \"\"\"\n    Unique strategy: \n    - Mixes Volume-Weighted MACD divergence with Parabolic SAR trend filter and sudden Volume Surge anomaly detection.\n    - Buys on bullish MACD-Price divergence + SAR uptrend + relative volume surge.\n    - Sells/shorts on bearish MACD-Price divergence + SAR downtrend + relative volume surge.\n    \"\"\"\n    # Calculate VWAP\n    data['vwap'] = (data['volume'] * (data['high'] + data['low'] + data['close'])/3).cumsum() / data['volume'].cumsum()\n    \n    # Calculate normal MACD\n    ema_short = data['close'].ewm(span=12, adjust=False).mean()\n    ema_long = data['close'].ewm(span=26, adjust=False).mean()\n    data['macd'] = ema_short - ema_long\n    data['macd_signal'] = data['macd'].ewm(span=9, adjust=False).mean()\n    \n    # MACD divergence with price vs VWAP\n    data['macd_divergence'] = data['close'] - data['vwap'] - (data['macd'] - data['macd_signal'])\n    \n    # Parabolic SAR (using basic implementation)\n    from talib import SAR\n    data['sar'] = SAR(data['high'].values, data['low'].values, acceleration=0.02, maximum=0.2)\n    data['trend'] = np.where(data['close'] > data['sar'], 1, -1)\n    \n    # Volume surge anomaly detection: relative to rolling median and mad\n    v_median = data['volume'].rolling(20).median()\n    v_mad = data['volume'].rolling(20).apply(lambda x: np.median(np.abs(x - np.median(x))), raw=True)\n    data['vol_surge'] = (data['volume'] > v_median + 2*v_mad)\n    \n    # Signals\n    data['signal'] = 0\n    \n    # Bullish MACD divergence: MACD divergence crosses up from negative, SAR uptrend, volume surge\n    bullish = (\n        (data['macd_divergence'].shift(1) < 0) & (data['macd_divergence'] > 0) &\n        (data['trend'] == 1) &\n        (data['vol_surge'])\n    )\n    \n    # Bearish MACD divergence: MACD divergence crosses down from positive, SAR downtrend, volume surge\n    bearish = (\n        (data['macd_divergence'].shift(1) > 0) & (data['macd_divergence'] < 0) &\n        (data['trend'] == -1) &\n        (data['vol_surge'])\n    )\n    \n    data.loc[bullish, 'signal'] = 1\n    data.loc[bearish, 'signal'] = -1\n    \n    # Fill signal=0 elsewhere\n    data['signal'] = data['signal'].fillna(0).astype(int)\n    \n    return data",
  "blueprint": {
    "nodes": [
      {
        "id": "mds",
        "type": "market_data_source",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "minute",
          "interval": 1
        }
      },
      {
        "id": "sma_vol",
        "type": "sma",
        "options": [
          {
            "id": "period",
            "value": 20,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "const2",
        "type": "number",
        "options": [
          {
            "id": "value",
            "value": 2,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "vol_thresh",
        "type": "mul",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "vol_surge",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "macd1",
        "type": "macd",
        "options": [
          {
            "id": "short_period",
            "value": 12,
            "name": "",
            "isExposed": false
          },
          {
            "id": "long_period",
            "value": 26,
            "name": "",
            "isExposed": false
          },
          {
            "id": "signal_period",
            "value": 9,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "zero_const",
        "type": "zero",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "cross_up",
        "type": "crossover",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "cross_down",
        "type": "crossover",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "psar1",
        "type": "psar",
        "options": [
          {
            "id": "acceleration_factor_step",
            "value": 0.02,
            "name": "",
            "isExposed": false
          },
          {
            "id": "acceleration_factor_maximum",
            "value": 0.2,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": {
          "type": "minute",
          "interval": 1
        }
      },
      {
        "id": "trend_up",
        "type": "gt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "trend_down",
        "type": "lt",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "all_buy",
        "type": "agg_all_of",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "all_sell",
        "type": "agg_all_of",
        "options": [],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      },
      {
        "id": "executor",
        "type": "trade_signal_executor",
        "options": [
          {
            "id": "closeIfIndecisive",
            "value": false,
            "name": "",
            "isExposed": false
          }
        ],
        "metadata": {
          "parentId": null
        },
        "timeframe": null
      }
    ],
    "edges": [
      {
        "source": {
          "id": "mds",
          "handle": "v"
        },
        "target": {
          "id": "sma_vol",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "sma_vol",
          "handle": "result"
        },
        "target": {
          "id": "vol_thresh",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "const2",
          "handle": "result"
        },
        "target": {
          "id": "vol_thresh",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "mds",
          "handle": "v"
        },
        "target": {
          "id": "vol_surge",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "vol_thresh",
          "handle": "result"
        },
        "target": {
          "id": "vol_surge",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "mds",
          "handle": "c"
        },
        "target": {
          "id": "macd1",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "macd1",
          "handle": "macd_histogram"
        },
        "target": {
          "id": "cross_up",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "zero_const",
          "handle": "result"
        },
        "target": {
          "id": "cross_up",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "zero_const",
          "handle": "result"
        },
        "target": {
          "id": "cross_down",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "macd1",
          "handle": "macd_histogram"
        },
        "target": {
          "id": "cross_down",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "mds",
          "handle": "c"
        },
        "target": {
          "id": "trend_up",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "psar1",
          "handle": "result"
        },
        "target": {
          "id": "trend_up",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "mds",
          "handle": "c"
        },
        "target": {
          "id": "trend_down",
          "handle": "*0"
        }
      },
      {
        "source": {
          "id": "psar1",
          "handle": "result"
        },
        "target": {
          "id": "trend_down",
          "handle": "*1"
        }
      },
      {
        "source": {
          "id": "cross_up",
          "handle": "result"
        },
        "target": {
          "id": "all_buy",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "trend_up",
          "handle": "result"
        },
        "target": {
          "id": "all_buy",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "vol_surge",
          "handle": "result"
        },
        "target": {
          "id": "all_buy",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "cross_down",
          "handle": "result"
        },
        "target": {
          "id": "all_sell",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "trend_down",
          "handle": "result"
        },
        "target": {
          "id": "all_sell",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "vol_surge",
          "handle": "result"
        },
        "target": {
          "id": "all_sell",
          "handle": "*"
        }
      },
      {
        "source": {
          "id": "all_buy",
          "handle": "result"
        },
        "target": {
          "id": "executor",
          "handle": "long"
        }
      },
      {
        "source": {
          "id": "all_sell",
          "handle": "result"
        },
        "target": {
          "id": "executor",
          "handle": "short"
        }
      }
    ]
  },
  "timestamp": "2025-06-23T14:48:33.520283",
  "tags": [
    "trading",
    "technical analysis",
    "MACD",
    "SAR",
    "volume"
  ]
}