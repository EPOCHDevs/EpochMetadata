# Source: strategies/statistical-analysis.md:18
# Section: Statistical Analysis & Machine Learning > Hidden Markov Model
# Type: complete_strategy

src = market_data_source()

returns = (src.c / src.c[1] - 1) * 100
vol = volatility(period=20)(src.c)
volume_ratio = src.v / sma(period=20)(src.v)

# 3-state regime detection
hmm_result = hmm(
    n_states=3,
    max_iterations=1000,
    lookback_window=252
)(returns)

# State interpretation (higher state number typically = higher vol/returns)
bull_regime = (hmm_result.state == 2) and (hmm_result.prob_state > 0.7)
bear_regime = (hmm_result.state == 0) and (hmm_result.prob_state > 0.7)

# Regime transition detection
regime_change = hmm_result.state != hmm_result.state[1]
# Exit when regime shifts
exit_on_change = regime_change

trade_signal_executor()(enter_long=bull_regime, exit_long=exit_on_change)
