# Source: strategies/calendrical-effects.md:110
# Section: Calendrical Effects & Seasonal Patterns > Advanced: Multi-Factor Calendar Filter
# Type: complete_strategy

src = market_data_source()

# All calendar effects
current_month = month_of_year()()
dow = day_of_week()()
first_week = week_of_month(week="First Week")()
pre_holiday = holiday(days_before=1)

# Month seasonality
strong_months = (current_month >= 11) or (current_month <= 4)
weak_months = (current_month >= 5) and (current_month <= 10)

# September = weakest month
september = current_month == 9

# Turn of month
tom = (month_of_year()() != month_of_year()()[1]) or (month_of_year()() != month_of_year()()[3])

# Day of week
monday = dow == 1
friday = dow == 5

# Combined risk-on/risk-off
risk_on_calendar = (
    strong_months and
    tom and
    first_week.result and
    friday and
    pre_holiday.result
)

risk_off_calendar = (
    weak_months and
    september and
    monday and
    not tom
)

# Use as portfolio heat adjuster
# Technical signal
signal = crossover(ema(period=20)(src.c), ema(period=50)(src.c))

# Entry sizing/aggressiveness based on calendar
aggressive_entry = risk_on_calendar and signal
conservative_entry = risk_off_calendar and signal and (rsi(period=14)(src.c) < 30)

entry = aggressive_entry or conservative_entry

trade_signal_executor()(enter_long=entry)
