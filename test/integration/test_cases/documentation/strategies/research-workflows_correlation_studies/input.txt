# Source: strategies/research-workflows.md:93
# Section: Research Workflows > Correlation Studies
# Type: partial_example

src = market_data_source()

# Lead-Lag Analysis: Does crypto volatility predict tech drawdowns?
crypto_vol = volatility(period=20)(src.c)
tech_dd = ulcer_index(period=20)(src.c)
concurrent_corr = rolling_corr(window=20)(x=crypto_vol, y=tech_dd)
# 5-day lag: shift crypto_vol forward by 5 periods
crypto_vol_lag5 = lag(period=5)(crypto_vol)
lag5_corr = rolling_corr(window=20)(x=crypto_vol_lag5, y=tech_dd)

# Stability: Short vs long window (regime shifts when divergence > 0.3)
corr_short = rolling_corr(window=20)(x=src.c, y=src.c)
corr_long = rolling_corr(window=60)(x=src.c, y=src.c)
regime_shift = abs(corr_short - corr_long) > 0.3

# Cross-Asset Matrix: Pairwise correlations for diversification analysis
corr_ab = rolling_corr(window=60)(x=src.c, y=src.c)
corr_ac = rolling_corr(window=60)(x=src.c, y=src.c)
avg_corr = (corr_ab + corr_ac) / 2.0  # Diversification measure

# Table report for time series analysis
table_report(sql="SELECT SLOT0 as concurrent_corr, SLOT1 as lag5_corr FROM self LIMIT 100")(
    concurrent_corr, lag5_corr
)
