# Source: strategies/research-workflows.mdx:95
# Section: Research Workflows > Correlation Studies
# Type: partial_example

src = market_data_source()

# Lead-Lag Analysis: Does crypto volatility predict tech drawdowns?
crypto_vol = volatility(period=20)(src.c)
tech_dd = ulcer_index(period=20)(src.c)
concurrent_corr = rolling_corr(window=20)(x=crypto_vol, y=tech_dd)
# 5-day lag: shift crypto_vol forward by 5 periods
crypto_vol_lag5 = lag(period=5)(crypto_vol)
lag5_corr = rolling_corr(window=20)(x=crypto_vol_lag5, y=tech_dd)

# Stability: Short vs long window (regime shifts when divergence > 0.3)
corr_short = rolling_corr(window=20)(x=src.c, y=src.c)
corr_long = rolling_corr(window=60)(x=src.c, y=src.c)
regime_shift = abs(corr_short - corr_long) > 0.3

# Cross-Asset Matrix: Pairwise correlations for diversification analysis
corr_ab = rolling_corr(window=60)(x=src.c, y=src.c)
corr_ac = rolling_corr(window=60)(x=src.c, y=src.c)
avg_corr = (corr_ab + corr_ac) / 2.0  # Diversification measure

# Table report for time series analysis - show high correlation periods
high_corr = (abs(concurrent_corr) > 0.7) or (abs(lag5_corr) > 0.7)

table_report(schema=TableReportSchema(
    title="High Correlation Periods",
    select_key=SLOT0,
    columns=[
        TableColumnSchema(column_id=SLOT1, title="Concurrent Corr"),
        TableColumnSchema(column_id=SLOT2, title="Lag 5 Corr")
    ]
))(high_corr, concurrent_corr, lag5_corr)
