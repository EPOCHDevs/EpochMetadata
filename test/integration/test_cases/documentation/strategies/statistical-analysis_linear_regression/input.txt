# Source: strategies/statistical-analysis.md:82
# Section: Statistical Analysis & Machine Learning > Linear Regression
# Type: complete_strategy

src = market_data_source()

bar_index = cumsum(1)
reg = linear_fit(window=50)(x=bar_index, y=src.c)

# Trend strength
strong_uptrend = reg.slope > 0.5
weak_uptrend = reg.slope > 0 and reg.slope < 0.3

# Deviation from trend (residual)
overextended = reg.residual > 2
underextended = reg.residual < -2

# Regression channel
fitted = reg.intercept + (reg.slope * bar_index)
std_dev = stdev(period=50)(reg.residual)
upper_band = fitted + (2 * std_dev)
lower_band = fitted - (2 * std_dev)

# Mean reversion to channel
entry = strong_uptrend and underextended and (src.c < lower_band)
exit = overextended or (src.c > upper_band)

trade_signal_executor()(enter_long=entry, exit_long=exit)
