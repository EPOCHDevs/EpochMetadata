# Source: strategies/statistical-analysis.md:140
# Section: Statistical Analysis & Machine Learning > Correlation & Covariance
# Type: complete_strategy

src = market_data_source()
spy = market_data_source()

spy_ret = (spy.c / spy.c[1] - 1) * 100
stock_ret = (src.c / src.c[1] - 1) * 100

# Correlation for pairs trading
corr = rolling_corr(window=60)(x=spy_ret, y=stock_ret)
cointegrated = corr > 0.7

# Short-term correlation for detecting breakdown
corr_short = rolling_corr(window=20)(x=spy_ret, y=stock_ret)
correlation_breaking = (corr_short < 0.5) and (corr > 0.7)

# Pairs trade setup
spread = src.c - spy.c
spread_z = zscore(window=60)(spread)

entry = cointegrated and (spread_z < -2) and not correlation_breaking
exit = spread_z > 0 or correlation_breaking

trade_signal_executor()(enter_long=entry, exit_long=exit)
