# Source: strategies/regime-detection.mdx:202
# Section: Regime Detection > Regime Transition Detection
# Type: partial_example

src = market_data_source()

# Track regime over time
adx_val = adx(period=14)(src.h, src.l, src.c)

trending_now = adx_val > 25
trending_prev = trending_now[1]

# Detect transitions
trend_to_range = trending_prev and not trending_now
range_to_trend = not trending_prev and trending_now

# Vol transitions
vol = yang_zhang(period=20, trading_periods=252)(src.l, src.h, src.o, src.c)
# Vol regime using percentile_select (50th percentile = median)
high_vol_now = percentile_select(lookback=252, percentile=50)(vol.result, 1, 0)  # Above median
high_vol_prev = high_vol_now[1]

vol_spike = not high_vol_prev and high_vol_now

# Transition = uncertain, reduce exposure
in_transition = trend_to_range or range_to_trend or vol_spike
stable_regime = not in_transition

entry_ok = stable_regime
