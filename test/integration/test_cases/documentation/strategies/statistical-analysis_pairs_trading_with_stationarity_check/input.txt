# Source: strategies/statistical-analysis.md:214
# Section: Statistical Analysis & Machine Learning > Pairs Trading with Stationarity Check
# Type: complete_strategy

stock_a = market_data_source()
stock_b = market_data_source()

spread = stock_a.c - stock_b.c

# NOTE: stationary_check not yet implemented - using correlation as proxy
# In production, verify spread is stationary using ADF test

# Check correlation
ret_a = (stock_a.c / stock_a.c[1] - 1) * 100
ret_b = (stock_b.c / stock_b.c[1] - 1) * 100
corr = rolling_corr(window=60)(x=ret_a, y=ret_b)
highly_correlated = corr > 0.75

# Only trade if highly correlated
tradeable = highly_correlated

# Mean reversion entry
spread_z = zscore(window=60)(spread)
entry_long_a = tradeable and (spread_z < -2)
entry_short_a = tradeable and (spread_z > 2)

# Exit on correlation breakdown
exit = not highly_correlated or (abs(spread_z) < 0.5)

trade_signal_executor()(enter_long=entry_long_a, exit_long=exit)
