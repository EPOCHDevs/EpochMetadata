# Source: strategies/statistical-analysis.md:171
# Section: Statistical Analysis & Machine Learning > Advanced: HMM + Hurst Adaptive Strategy
# Type: complete_strategy

src = market_data_source()

# Combine probabilistic and fractal regime detection
returns = (src.c / src.c[1] - 1) * 100
vol = volatility(period=20)(src.c)
volume_ratio = src.v / sma(period=20)(src.v)

# HMM for bull/bear/neutral
hmm_result = hmm(n_states=3, lookback_window=252)(returns)
bull_state = (hmm_result.state == 2) and (hmm_result.prob_state > 0.8)

# Hurst for mean-revert vs trend
hurst = rolling_hurst_exponent(window=252)(returns)
mean_reverting = hurst.result < 0.45
trending = hurst.result > 0.55

# Linear regression for entry timing
fitted = linreg(period=50)(src.c)
slope = linregslope(period=50)(src.c)
residual = src.c - fitted

# Strategy logic
# Bull+Trending = follow slope, enter on pullback
bull_trend = bull_state and trending and (slope > 0.3)
pullback = residual < -1.5

# Bull+Mean-reverting = buy extreme dips
bull_mr = bull_state and mean_reverting
price_z = zscore(window=20)(src.c)
extreme_dip = price_z < -2.5

entry = (bull_trend and pullback) or (bull_mr and extreme_dip)
# Exit on regime change
exit = not bull_state or (hmm_result.state != hmm_result.state[1])

trade_signal_executor()(enter_long=entry, exit_long=exit)
