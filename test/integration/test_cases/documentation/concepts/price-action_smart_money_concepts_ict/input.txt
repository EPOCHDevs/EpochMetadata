# Source: concepts/price-action.mdx:131
# Section: Price Action Analysis > Smart Money Concepts (ICT)
# Type: complete_code

src = market_data_source(timeframe="15Min")

swings = swing_highs_lows(swing_length=5)(src.h, src.l)
structure = bos_choch(close_break=true)(swings.high_low, swings.level)
ob = order_blocks(close_mitigation=false)(swings.high_low, swings.level)
fvg = fair_value_gap(join_consecutive=True)()
liq = liquidity(range_percent=0.02)(swings.high_low, swings.level)
retr = retracements()(swings.high_low, swings.level)

# Score each confluence factor
confirmations = (structure.bos == 1 ? 1 : 0) +
                ((ob.ob == 1 and ob.mitigated_index == 0) ? 1 : 0) +
                ((fvg.fvg == 1 and src.c >= fvg.bottom) ? 1 : 0) +
                (liq.swept[1:5] != 0 ? 1 : 0) +
                (retr.current_retracement >= 50 and retr.current_retracement <= 70 ? 1 : 0)

# Require 3+ confirmations
entry = confirmations >= 3
