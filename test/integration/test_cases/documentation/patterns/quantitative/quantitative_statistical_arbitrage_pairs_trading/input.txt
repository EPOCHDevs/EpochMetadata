# Source: strategies/patterns/quantitative.mdx:76
# Section: Quantitative Strategies > Statistical Arbitrage (Pairs Trading)
# Type: complete_strategy

# Two correlated assets
asset1 = market_data_source()  # Stock A
asset2 = market_data_source()  # Stock B (separate configuration)

# Calculate spread
spread = asset1.c - asset2.c

# Spread statistics
spread_ma = sma(period=20)(spread)
spread_std = stddev(period=20)(spread)

# Z-score of spread
z_score = (spread - spread_ma) / spread_std

# Monitor correlation regime
corr = rolling_corr(window=20)(x=asset1.c, y=asset2.c)
high_corr = corr > 0.8  # Only trade when correlated

# Entry: Extreme z-score + high correlation
entry_long_spread = high_corr and (z_score < -2.0)   # Spread cheap
entry_short_spread = high_corr and (z_score > 2.0)   # Spread expensive

# Exit: Mean reversion or correlation breakdown
exit_long = (abs(z_score) < 0.5) or (corr < 0.5)
exit_short = (abs(z_score) < 0.5) or (corr < 0.5)

# Execute (long spread = long A, short B)
trade_signal_executor()(
    enter_long=entry_long_spread,
    enter_short=entry_short_spread,
    exit_long=exit_long,
    exit_short=exit_short
)
