{
  "tests": [
    {
      "title": "Intraday Gap Detection - 4 pip gap (FX)",
      "input": {
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-01T09:01:00",
          "2024-01-01T09:02:00",
          "2024-01-01T09:03:00"
        ],
        "o": [
          1.0500,
          1.0505,
          1.0514,
          1.0516
        ],
        "h": [
          1.0510,
          1.0515,
          1.0524,
          1.0522
        ],
        "l": [
          1.0498,
          1.0503,
          1.0507,
          1.0514
        ],
        "c": [
          1.0505,
          1.0508,
          1.0516,
          1.0519
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "bar_gap#gap_size": [
            null,
            null,
            0.057100912311048464,
            null
          ],
          "bar_gap#gap_filled": [
            null,
            null,
            true,
            null
          ],
          "bar_gap#gap_retrace": [
            null,
            null,
            1.1666666666666667,
            null
          ],
          "bar_gap#psc": [
            null,
            null,
            1.0508,
            null
          ],
          "bar_gap#psc_timestamp": [
            null,
            null,
            "2024-01-01 09:01:00.000000000Z",
            null
          ]
        }
      },
      "options": {
        "transform_name": "bar_gap",
        "output_id": "bar_gap",
        "inputs": "",
        "fill_percent": 100,
        "min_gap_size": 0.04,
        "timeframe": "1Min"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Intraday Gap - Above minimum threshold (detected)",
      "input": {
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-01T09:01:00",
          "2024-01-01T09:02:00",
          "2024-01-01T09:03:00"
        ],
        "o": [
          100.0,
          100.1,
          100.37,
          100.2
        ],
        "h": [
          100.5,
          100.6,
          100.7,
          100.8
        ],
        "l": [
          99.8,
          100.0,
          100.1,
          100.15
        ],
        "c": [
          100.1,
          100.12,
          100.18,
          100.25
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "bar_gap#gap_size": [
            null,
            null,
            0.24970035956851777,
            null
          ],
          "bar_gap#gap_filled": [
            null,
            null,
            true,
            null
          ],
          "bar_gap#gap_retrace": [
            null,
            null,
            1.080000000000041,
            null
          ],
          "bar_gap#psc": [
            null,
            null,
            100.12,
            null
          ],
          "bar_gap#psc_timestamp": [
            null,
            null,
            "2024-01-01 09:01:00.000000000Z",
            null
          ]
        }
      },
      "options": {
        "transform_name": "bar_gap",
        "output_id": "bar_gap",
        "inputs": "",
        "fill_percent": 100,
        "min_gap_size": 0.2,
        "timeframe": "1Min"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Trading Halt Gap - Large intraday gap (2%+)",
      "input": {
        "timestamp": [
          "2024-01-01T10:00:00",
          "2024-01-01T10:05:00",
          "2024-01-01T10:10:00",
          "2024-01-01T10:15:00"
        ],
        "o": [
          100.0,
          101.0,
          103.5,
          104.0
        ],
        "h": [
          102.0,
          103.0,
          105.0,
          106.0
        ],
        "l": [
          99.0,
          100.5,
          102.0,
          103.5
        ],
        "c": [
          101.0,
          102.0,
          104.0,
          105.0
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "bar_gap#gap_size": [
            null,
            null,
            1.4705882352941175,
            null
          ],
          "bar_gap#gap_filled": [
            null,
            null,
            true,
            null
          ],
          "bar_gap#gap_retrace": [
            null,
            null,
            1.0,
            null
          ],
          "bar_gap#psc": [
            null,
            null,
            102.0,
            null
          ],
          "bar_gap#psc_timestamp": [
            null,
            null,
            "2024-01-01 10:05:00.000000000Z",
            null
          ]
        }
      },
      "options": {
        "transform_name": "bar_gap",
        "output_id": "bar_gap",
        "inputs": "",
        "fill_percent": 100,
        "min_gap_size": 1.0,
        "timeframe": "5Min"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "No Day Boundary Check - Intraday gaps same day",
      "input": {
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-01T10:00:00",
          "2024-01-01T11:00:00",
          "2024-01-01T12:00:00"
        ],
        "o": [
          100.0,
          102.0,
          105.0,
          107.0
        ],
        "h": [
          103.0,
          106.0,
          109.0,
          111.0
        ],
        "l": [
          99.0,
          101.0,
          104.0,
          106.0
        ],
        "c": [
          102.0,
          105.0,
          107.0,
          109.0
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "bar_gap#gap_size": [
            null,
            null,
            null,
            null
          ],
          "bar_gap#gap_filled": [
            null,
            null,
            null,
            null
          ],
          "bar_gap#gap_retrace": [
            null,
            null,
            null,
            null
          ],
          "bar_gap#psc": [
            null,
            null,
            null,
            null
          ],
          "bar_gap#psc_timestamp": [
            null,
            null,
            null,
            null
          ]
        }
      },
      "options": {
        "transform_name": "bar_gap",
        "output_id": "bar_gap",
        "inputs": "",
        "fill_percent": 100,
        "min_gap_size": 0.0,
        "timeframe": "1H"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Unfilled Gap - Immediate fill detection only",
      "input": {
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-01T09:01:00",
          "2024-01-01T09:02:00",
          "2024-01-01T09:03:00"
        ],
        "o": [
          100.0,
          100.5,
          103.0,
          103.5
        ],
        "h": [
          101.0,
          101.5,
          104.0,
          104.5
        ],
        "l": [
          99.5,
          100.2,
          102.5,
          103.0
        ],
        "c": [
          100.5,
          101.0,
          103.5,
          104.0
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "bar_gap#gap_size": [
            null,
            null,
            1.9801980198019802,
            null
          ],
          "bar_gap#gap_filled": [
            null,
            null,
            false,
            null
          ],
          "bar_gap#gap_retrace": [
            null,
            null,
            0.0,
            null
          ],
          "bar_gap#psc": [
            null,
            null,
            101.0,
            null
          ],
          "bar_gap#psc_timestamp": [
            null,
            null,
            "2024-01-01 09:01:00.000000000Z",
            null
          ]
        }
      },
      "options": {
        "transform_name": "bar_gap",
        "output_id": "bar_gap",
        "inputs": "",
        "fill_percent": 100,
        "min_gap_size": 1.5,
        "timeframe": "1Min"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    }
  ]
}
