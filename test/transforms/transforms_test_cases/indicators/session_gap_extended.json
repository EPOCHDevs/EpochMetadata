{
  "tests": [
    {
      "title": "Up Gap Fully Filled - Low reaches previous close",
      "input": {
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-01T16:00:00",
          "2024-01-02T09:00:00",
          "2024-01-02T10:00:00",
          "2024-01-02T16:00:00"
        ],
        "o": [
          100.0,
          99.0,
          105.0,
          104.0,
          103.0
        ],
        "h": [
          101.0,
          100.5,
          106.0,
          105.0,
          104.0
        ],
        "l": [
          99.0,
          98.0,
          104.0,
          100.0,
          102.0
        ],
        "c": [
          100.0,
          100.0,
          105.0,
          103.0,
          103.5
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "session_gap#gap_size": [
            null,
            null,
            5.0,
            null,
            null
          ],
          "session_gap#gap_filled": [
            null,
            null,
            false,
            true,
            true
          ],
          "session_gap#gap_retrace": [
            null,
            null,
            0.2,
            1.0,
            0.6
          ],
          "session_gap#psc": [
            null,
            null,
            100.0,
            100.0,
            100.0
          ],
          "session_gap#psc_timestamp": [
            null,
            null,
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z"
          ]
        }
      },
      "options": {
        "transform_name": "session_gap",
        "output_id": "session_gap",
        "inputs": "",
        "fill_percent": 100,
        "timeframe": "1H"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Down Gap Fully Filled - High reaches previous close",
      "input": {
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-01T16:00:00",
          "2024-01-02T09:00:00",
          "2024-01-02T10:00:00",
          "2024-01-02T16:00:00"
        ],
        "o": [
          100.0,
          101.0,
          95.0,
          96.0,
          97.0
        ],
        "h": [
          102.0,
          103.0,
          96.0,
          100.0,
          98.0
        ],
        "l": [
          99.0,
          100.0,
          94.0,
          95.0,
          96.0
        ],
        "c": [
          101.0,
          100.0,
          95.5,
          97.0,
          97.5
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "session_gap#gap_size": [
            null,
            null,
            -5.0,
            null,
            null
          ],
          "session_gap#gap_filled": [
            null,
            null,
            false,
            true,
            true
          ],
          "session_gap#gap_retrace": [
            null,
            null,
            0.2,
            1.0,
            0.6
          ],
          "session_gap#psc": [
            null,
            null,
            100.0,
            100.0,
            100.0
          ],
          "session_gap#psc_timestamp": [
            null,
            null,
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z"
          ]
        }
      },
      "options": {
        "transform_name": "session_gap",
        "output_id": "session_gap",
        "inputs": "",
        "fill_percent": 100,
        "timeframe": "1H"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Up Gap Partially Filled - Low retraces partway",
      "input": {
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-01T16:00:00",
          "2024-01-02T09:00:00",
          "2024-01-02T10:00:00",
          "2024-01-02T16:00:00"
        ],
        "o": [
          100.0,
          99.0,
          110.0,
          108.0,
          107.0
        ],
        "h": [
          101.0,
          100.5,
          112.0,
          110.0,
          109.0
        ],
        "l": [
          99.0,
          98.0,
          109.0,
          105.0,
          106.0
        ],
        "c": [
          100.0,
          100.0,
          111.0,
          107.0,
          108.0
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "session_gap#gap_size": [
            null,
            null,
            10.0,
            null,
            null
          ],
          "session_gap#gap_filled": [
            null,
            null,
            false,
            false,
            false
          ],
          "session_gap#gap_retrace": [
            null,
            null,
            0.1,
            0.5,
            0.4
          ],
          "session_gap#psc": [
            null,
            null,
            100.0,
            100.0,
            100.0
          ],
          "session_gap#psc_timestamp": [
            null,
            null,
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z"
          ]
        }
      },
      "options": {
        "transform_name": "session_gap",
        "output_id": "session_gap",
        "inputs": "",
        "fill_percent": 100,
        "timeframe": "1H"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Down Gap Partially Filled - High retraces partway",
      "input": {
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-01T16:00:00",
          "2024-01-02T09:00:00",
          "2024-01-02T10:00:00",
          "2024-01-02T16:00:00"
        ],
        "o": [
          100.0,
          101.0,
          90.0,
          92.0,
          93.0
        ],
        "h": [
          102.0,
          103.0,
          91.0,
          95.0,
          94.0
        ],
        "l": [
          99.0,
          100.0,
          89.0,
          91.0,
          92.0
        ],
        "c": [
          101.0,
          100.0,
          90.5,
          93.0,
          93.5
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "session_gap#gap_size": [
            null,
            null,
            -10.0,
            null,
            null
          ],
          "session_gap#gap_filled": [
            null,
            null,
            false,
            false,
            false
          ],
          "session_gap#gap_retrace": [
            null,
            null,
            0.1,
            0.5,
            0.4
          ],
          "session_gap#psc": [
            null,
            null,
            100.0,
            100.0,
            100.0
          ],
          "session_gap#psc_timestamp": [
            null,
            null,
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z"
          ]
        }
      },
      "options": {
        "transform_name": "session_gap",
        "output_id": "session_gap",
        "inputs": "",
        "fill_percent": 100,
        "timeframe": "1H"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "No Fill - Price never retraces toward previous close",
      "input": {
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-01T16:00:00",
          "2024-01-02T09:00:00",
          "2024-01-02T10:00:00",
          "2024-01-02T16:00:00"
        ],
        "o": [
          100.0,
          99.0,
          110.0,
          112.0,
          114.0
        ],
        "h": [
          101.0,
          100.5,
          113.0,
          115.0,
          117.0
        ],
        "l": [
          99.0,
          98.0,
          110.0,
          111.0,
          113.0
        ],
        "c": [
          100.0,
          100.0,
          112.0,
          114.0,
          116.0
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "session_gap#gap_size": [
            null,
            null,
            10.0,
            null,
            null
          ],
          "session_gap#gap_filled": [
            null,
            null,
            false,
            false,
            false
          ],
          "session_gap#gap_retrace": [
            null,
            null,
            0.0,
            0.0,
            0.0
          ],
          "session_gap#psc": [
            null,
            null,
            100.0,
            100.0,
            100.0
          ],
          "session_gap#psc_timestamp": [
            null,
            null,
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z"
          ]
        }
      },
      "options": {
        "transform_name": "session_gap",
        "output_id": "session_gap",
        "inputs": "",
        "fill_percent": 100,
        "timeframe": "1H"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Gap Fills on Opening Bar - Immediate fill",
      "input": {
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-01T16:00:00",
          "2024-01-02T09:00:00",
          "2024-01-02T10:00:00"
        ],
        "o": [
          100.0,
          99.0,
          105.0,
          103.0
        ],
        "h": [
          101.0,
          100.5,
          107.0,
          104.0
        ],
        "l": [
          99.0,
          98.0,
          100.0,
          102.0
        ],
        "c": [
          100.0,
          100.0,
          103.0,
          103.5
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "session_gap#gap_size": [
            null,
            null,
            5.0,
            null
          ],
          "session_gap#gap_filled": [
            null,
            null,
            true,
            true
          ],
          "session_gap#gap_retrace": [
            null,
            null,
            1.0,
            0.6
          ],
          "session_gap#psc": [
            null,
            null,
            100.0,
            100.0
          ],
          "session_gap#psc_timestamp": [
            null,
            null,
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z"
          ]
        }
      },
      "options": {
        "transform_name": "session_gap",
        "output_id": "session_gap",
        "inputs": "",
        "fill_percent": 100,
        "timeframe": "1H"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Gap Fills Later in Day - Delayed fill",
      "input": {
        "timestamp": [
          "2024-01-01T16:00:00",
          "2024-01-02T09:00:00",
          "2024-01-02T10:00:00",
          "2024-01-02T11:00:00",
          "2024-01-02T14:00:00",
          "2024-01-02T16:00:00"
        ],
        "o": [
          100.0,
          105.0,
          104.0,
          103.5,
          102.0,
          101.0
        ],
        "h": [
          100.5,
          106.0,
          105.0,
          104.0,
          103.0,
          102.0
        ],
        "l": [
          99.5,
          104.0,
          103.0,
          103.0,
          100.0,
          100.5
        ],
        "c": [
          100.0,
          105.0,
          103.5,
          103.2,
          101.0,
          101.5
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "session_gap#gap_size": [
            null,
            5.0,
            null,
            null,
            null,
            null
          ],
          "session_gap#gap_filled": [
            null,
            false,
            false,
            false,
            true,
            true
          ],
          "session_gap#gap_retrace": [
            null,
            0.2,
            0.4,
            0.4,
            1.0,
            0.9
          ],
          "session_gap#psc": [
            null,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0
          ],
          "session_gap#psc_timestamp": [
            null,
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z"
          ]
        }
      },
      "options": {
        "transform_name": "session_gap",
        "output_id": "session_gap",
        "inputs": "",
        "fill_percent": 100,
        "timeframe": "1H"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Gap Tracking Stops at Day End - New day resets",
      "input": {
        "timestamp": [
          "2024-01-01T16:00:00",
          "2024-01-02T09:00:00",
          "2024-01-02T16:00:00",
          "2024-01-03T09:00:00",
          "2024-01-03T16:00:00"
        ],
        "o": [
          100.0,
          105.0,
          104.0,
          108.0,
          107.0
        ],
        "h": [
          100.5,
          106.0,
          105.0,
          110.0,
          109.0
        ],
        "l": [
          99.5,
          104.0,
          103.0,
          107.0,
          106.0
        ],
        "c": [
          100.0,
          105.0,
          104.0,
          108.0,
          107.0
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "session_gap#gap_size": [
            null,
            5.0,
            null,
            3.846153846153846,
            null
          ],
          "session_gap#gap_filled": [
            null,
            false,
            false,
            false,
            false
          ],
          "session_gap#gap_retrace": [
            null,
            0.2,
            0.4,
            0.25,
            0.5
          ],
          "session_gap#psc": [
            null,
            100.0,
            100.0,
            104.0,
            104.0
          ],
          "session_gap#psc_timestamp": [
            null,
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-02 16:00:00.000000000Z",
            "2024-01-02 16:00:00.000000000Z"
          ]
        }
      },
      "options": {
        "transform_name": "session_gap",
        "output_id": "session_gap",
        "inputs": "",
        "fill_percent": 100,
        "timeframe": "1H"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Partial Fill with 50% Fill Threshold",
      "input": {
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-01T16:00:00",
          "2024-01-02T09:00:00",
          "2024-01-02T10:00:00",
          "2024-01-02T16:00:00"
        ],
        "o": [
          100.0,
          99.0,
          110.0,
          108.0,
          107.0
        ],
        "h": [
          101.0,
          100.5,
          112.0,
          110.0,
          109.0
        ],
        "l": [
          99.0,
          98.0,
          109.0,
          105.0,
          106.0
        ],
        "c": [
          100.0,
          100.0,
          111.0,
          107.0,
          108.0
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "session_gap#gap_size": [
            null,
            null,
            10.0,
            null,
            null
          ],
          "session_gap#gap_filled": [
            null,
            null,
            false,
            true,
            true
          ],
          "session_gap#gap_retrace": [
            null,
            null,
            0.1,
            0.5,
            0.4
          ],
          "session_gap#psc": [
            null,
            null,
            100.0,
            100.0,
            100.0
          ],
          "session_gap#psc_timestamp": [
            null,
            null,
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z",
            "2024-01-01 16:00:00.000000000Z"
          ]
        }
      },
      "options": {
        "transform_name": "session_gap",
        "output_id": "session_gap",
        "inputs": "",
        "fill_percent": 50,
        "timeframe": "1H"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    }
  ]
}