{
  "tests": [
    {
      "title": "Gap Report Histogram - Gap Size Distribution",
      "input": {
        "gap_size": [
          0.5,
          1.2,
          0.8,
          2.1,
          1.5,
          0.3,
          1.8,
          0.9,
          2.5,
          1.1
        ],
        "gap_filled": [
          true,
          false,
          true,
          false,
          true,
          true,
          false,
          true,
          false,
          true
        ],
        "psc": [
          100.0,
          100.5,
          101.2,
          100.8,
          102.1,
          101.5,
          100.3,
          101.8,
          100.9,
          102.5
        ],
        "gap_retrace": [
          0.3,
          0.0,
          0.5,
          0.0,
          0.7,
          0.8,
          0.0,
          1.0,
          0.0,
          1.2
        ],
        "psc_timestamp": [
          "2022-01-01T00:00:00",
          "2022-01-02T00:00:00",
          "2022-01-03T00:00:00",
          "2022-01-04T00:00:00",
          "2022-01-05T00:00:00",
          "2022-01-06T00:00:00",
          "2022-01-07T00:00:00",
          "2022-01-08T00:00:00",
          "2022-01-09T00:00:00",
          "2022-01-10T00:00:00"
        ],
        "c": [
          100.8,
          101.5,
          102.0,
          102.8,
          103.2,
          101.9,
          102.1,
          102.5,
          103.1,
          103.8
        ],
        "timestamp": [
          "2024-01-01T09:00:00",
          "2024-01-02T09:00:00",
          "2024-01-03T09:00:00",
          "2024-01-04T09:00:00",
          "2024-01-05T09:00:00",
          "2024-01-06T09:00:00",
          "2024-01-07T09:00:00",
          "2024-01-08T09:00:00",
          "2024-01-09T09:00:00",
          "2024-01-10T09:00:00"
        ]
      },
      "expect": {
        "type": "tearsheet",
        "cards": {
          "cards": [
            {
              "category": "Reports",
              "group_size": 4,
              "type": "WidgetCard",
              "data": [
                {
                  "title": "Total Gaps",
                  "value": 10,
                  "group": 0,
                  "type": "TypeInteger"
                },
                {
                  "title": "Gap Up %",
                  "value": 100.0,
                  "group": 1,
                  "type": "TypePercent"
                },
                {
                  "title": "Gap Down %",
                  "value": 0.0,
                  "group": 2,
                  "type": "TypePercent"
                },
                {
                  "title": "Fill Rate",
                  "value": 60.0,
                  "group": 3,
                  "type": "TypePercent"
                }
              ]
            }
          ]
        },
        "charts": [
          {
            "title": "Gap Fill Analysis",
            "category": "Reports",
            "type": "WidgetBarChart",
            "stacked": true,
            "vertical": false,
            "bars": [
              {
                "name": "Filled",
                "data": [
                  6,
                  0,
                  6
                ]
              },
              {
                "name": "Not Filled",
                "data": [
                  4,
                  0,
                  4
                ]
              }
            ]
          },
          {
            "title": "Gap Fill Rate by Size Category",
            "category": "Reports",
            "type": "WidgetBarChart",
            "stacked": true,
            "vertical": false,
            "bars": [
              {
                "name": "Filled",
                "data": [
                  0,
                  1,
                  1,
                  2,
                  2,
                  0
                ]
              },
              {
                "name": "Not Filled",
                "data": [
                  0,
                  0,
                  0,
                  0,
                  2,
                  2
                ]
              }
            ]
          },
          {
            "title": "Gap Fill Rate by Day of Week",
            "category": "Reports",
            "type": "WidgetBarChart",
            "stacked": true,
            "vertical": false,
            "bars": [
              {
                "name": "Filled",
                "data": [
                  2,
                  0,
                  2,
                  0,
                  1,
                  1,
                  0
                ]
              },
              {
                "name": "Not Filled",
                "data": [
                  0,
                  2,
                  0,
                  1,
                  0,
                  0,
                  1
                ]
              }
            ]
          },
          {
            "title": "Gap Size Distribution",
            "category": "Reports",
            "type": "WidgetHistogramChart",
            "bins": [
              {
                "min": 0.3,
                "max": 0.74,
                "count": 3
              },
              {
                "min": 0.74,
                "max": 1.18,
                "count": 4
              },
              {
                "min": 1.18,
                "max": 1.62,
                "count": 2
              },
              {
                "min": 1.62,
                "max": 2.06,
                "count": 0
              },
              {
                "min": 2.06,
                "max": 2.5,
                "count": 1
              }
            ]
          }
        ],
        "tables": [
          {
            "title": "Gap Up Fill Analysis",
            "category": "Reports",
            "type": "WidgetDataTable",
            "columns": [
              {
                "name": "Category",
                "type": "TypeString"
              },
              {
                "name": "Frequency",
                "type": "TypeInteger"
              },
              {
                "name": "Percentage",
                "type": "TypePercent"
              }
            ],
            "data": {
              "rows": [
                [
                  "gap up",
                  10,
                  100.0
                ],
                [
                  "gap up filled",
                  6,
                  60.0
                ],
                [
                  "gap up not filled",
                  4,
                  40.0
                ]
              ]
            }
          },
          {
            "title": "Gap Down Fill Analysis",
            "category": "Reports",
            "type": "WidgetDataTable",
            "columns": [
              {
                "name": "Category",
                "type": "TypeString"
              },
              {
                "name": "Frequency",
                "type": "TypeInteger"
              },
              {
                "name": "Percentage",
                "type": "TypePercent"
              }
            ],
            "data": {
              "rows": [
                [
                  "gap down",
                  0,
                  0.0
                ],
                [
                  "gap down filled",
                  0,
                  0.0
                ],
                [
                  "gap down not filled",
                  0,
                  0.0
                ]
              ]
            }
          },
          {
            "title": "Gap Analysis Details",
            "category": "Reports",
            "type": "WidgetDataTable",
            "columns": [
              {
                "name": "Gap Size %",
                "type": "TypePercent"
              },
              {
                "name": "Gap Type",
                "type": "TypeString"
              },
              {
                "name": "Filled Status",
                "type": "TypeString"
              },
              {
                "name": "Day of Week",
                "type": "TypeString"
              },
              {
                "name": "Fill Time",
                "type": "TypeString"
              },
              {
                "name": "Performance",
                "type": "TypeString"
              }
            ],
            "data": {
              "rows": [
                [
                  0.5,
                  "gap up",
                  "filled",
                  "Monday",
                  "before 13:00",
                  "green"
                ],
                [
                  1.2,
                  "gap up",
                  "not filled",
                  "Tuesday",
                  "",
                  "green"
                ],
                [
                  0.8,
                  "gap up",
                  "filled",
                  "Wednesday",
                  "before 13:00",
                  "green"
                ],
                [
                  2.1,
                  "gap up",
                  "not filled",
                  "Thursday",
                  "",
                  "green"
                ],
                [
                  1.5,
                  "gap up",
                  "filled",
                  "Friday",
                  "before 13:00",
                  "green"
                ],
                [
                  0.3,
                  "gap up",
                  "filled",
                  "Saturday",
                  "before 13:00",
                  "green"
                ],
                [
                  1.8,
                  "gap up",
                  "not filled",
                  "Sunday",
                  "",
                  "green"
                ],
                [
                  0.9,
                  "gap up",
                  "filled",
                  "Monday",
                  "before 13:00",
                  "green"
                ],
                [
                  2.5,
                  "gap up",
                  "not filled",
                  "Tuesday",
                  "",
                  "green"
                ],
                [
                  1.1,
                  "gap up",
                  "filled",
                  "Wednesday",
                  "before 13:00",
                  "green"
                ]
              ]
            }
          }
        ]
      },
      "options": {
        "transform_name": "gap_report",
        "output_id": "test_gap_histogram",
        "fill_time_pivot_hour": 13,
        "histogram_bins": 5,
        "inputs": "{gap_filled: gap_filled, gap_retrace: gap_retrace, gap_size: gap_size, psc: psc, psc_timestamp: psc_timestamp}",
        "timeframe": "1D"
      },
      "timestamp_columns": [
        "psc_timestamp",
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Gap Report Histogram - Wider Distribution",
      "input": {
        "gap_size": [
          0.1,
          0.5,
          1.0,
          1.5,
          2.0,
          2.5,
          3.0,
          3.5,
          4.0,
          4.5
        ],
        "gap_filled": [
          true,
          true,
          false,
          true,
          false,
          true,
          false,
          true,
          false,
          true
        ],
        "psc": [
          100.0,
          100.1,
          100.5,
          101.0,
          101.5,
          102.0,
          102.5,
          103.0,
          103.5,
          104.0
        ],
        "gap_retrace": [
          0.3,
          0.4,
          0.0,
          0.6000000000000001,
          0.0,
          0.8,
          0.0,
          1.0,
          0.0,
          1.2
        ],
        "psc_timestamp": [
          "2022-01-01T00:00:00",
          "2022-01-02T00:00:00",
          "2022-01-03T00:00:00",
          "2022-01-04T00:00:00",
          "2022-01-05T00:00:00",
          "2022-01-06T00:00:00",
          "2022-01-07T00:00:00",
          "2022-01-08T00:00:00",
          "2022-01-09T00:00:00",
          "2022-01-10T00:00:00"
        ],
        "c": [
          100.2,
          100.8,
          101.2,
          102.1,
          102.8,
          103.5,
          104.2,
          104.8,
          105.5,
          106.2
        ],
        "timestamp": [
          "2024-01-21T09:00:00",
          "2024-01-22T09:00:00",
          "2024-01-23T09:00:00",
          "2024-01-24T09:00:00",
          "2024-01-25T09:00:00",
          "2024-01-26T09:00:00",
          "2024-01-27T09:00:00",
          "2024-01-28T09:00:00",
          "2024-01-29T09:00:00",
          "2024-01-30T09:00:00"
        ]
      },
      "expect": {
        "type": "tearsheet",
        "cards": {
          "cards": [
            {
              "category": "Reports",
              "group_size": 4,
              "type": "WidgetCard",
              "data": [
                {
                  "title": "Total Gaps",
                  "value": 10,
                  "group": 0,
                  "type": "TypeInteger"
                },
                {
                  "title": "Gap Up %",
                  "value": 100.0,
                  "group": 1,
                  "type": "TypePercent"
                },
                {
                  "title": "Gap Down %",
                  "value": 0.0,
                  "group": 2,
                  "type": "TypePercent"
                },
                {
                  "title": "Fill Rate",
                  "value": 60.0,
                  "group": 3,
                  "type": "TypePercent"
                }
              ]
            }
          ]
        },
        "charts": [
          {
            "title": "Gap Fill Analysis",
            "category": "Reports",
            "type": "WidgetBarChart",
            "stacked": true,
            "vertical": false,
            "bars": [
              {
                "name": "Filled",
                "data": [
                  6,
                  0,
                  6
                ]
              },
              {
                "name": "Not Filled",
                "data": [
                  4,
                  0,
                  4
                ]
              }
            ]
          },
          {
            "title": "Gap Fill Rate by Size Category",
            "category": "Reports",
            "type": "WidgetBarChart",
            "stacked": true,
            "vertical": false,
            "bars": [
              {
                "name": "Filled",
                "data": [
                  1,
                  0,
                  1,
                  0,
                  1,
                  3
                ]
              },
              {
                "name": "Not Filled",
                "data": [
                  0,
                  0,
                  0,
                  0,
                  1,
                  3
                ]
              }
            ]
          },
          {
            "title": "Gap Fill Rate by Day of Week",
            "category": "Reports",
            "type": "WidgetBarChart",
            "stacked": true,
            "vertical": false,
            "bars": [
              {
                "name": "Filled",
                "data": [
                  1,
                  1,
                  1,
                  0,
                  1,
                  0,
                  2
                ]
              },
              {
                "name": "Not Filled",
                "data": [
                  1,
                  1,
                  0,
                  1,
                  0,
                  1,
                  0
                ]
              }
            ]
          },
          {
            "title": "Gap Size Distribution",
            "category": "Reports",
            "type": "WidgetHistogramChart",
            "bins": [
              {
                "min": 0.1,
                "max": 0.98,
                "count": 2
              },
              {
                "min": 0.98,
                "max": 1.86,
                "count": 3
              },
              {
                "min": 1.86,
                "max": 2.74,
                "count": 2
              },
              {
                "min": 2.74,
                "max": 3.62,
                "count": 2
              },
              {
                "min": 3.62,
                "max": 4.5,
                "count": 1
              }
            ]
          }
        ],
        "tables": [
          {
            "title": "Gap Up Fill Analysis",
            "category": "Reports",
            "type": "WidgetDataTable",
            "columns": [
              {
                "name": "Category",
                "type": "TypeString"
              },
              {
                "name": "Frequency",
                "type": "TypeInteger"
              },
              {
                "name": "Percentage",
                "type": "TypePercent"
              }
            ],
            "data": {
              "rows": [
                [
                  "gap up",
                  10,
                  100.0
                ],
                [
                  "gap up filled",
                  6,
                  60.0
                ],
                [
                  "gap up not filled",
                  4,
                  40.0
                ]
              ]
            }
          },
          {
            "title": "Gap Down Fill Analysis",
            "category": "Reports",
            "type": "WidgetDataTable",
            "columns": [
              {
                "name": "Category",
                "type": "TypeString"
              },
              {
                "name": "Frequency",
                "type": "TypeInteger"
              },
              {
                "name": "Percentage",
                "type": "TypePercent"
              }
            ],
            "data": {
              "rows": [
                [
                  "gap down",
                  0,
                  0.0
                ],
                [
                  "gap down filled",
                  0,
                  0.0
                ],
                [
                  "gap down not filled",
                  0,
                  0.0
                ]
              ]
            }
          },
          {
            "title": "Gap Analysis Details",
            "category": "Reports",
            "type": "WidgetDataTable",
            "columns": [
              {
                "name": "Gap Size %",
                "type": "TypePercent"
              },
              {
                "name": "Gap Type",
                "type": "TypeString"
              },
              {
                "name": "Filled Status",
                "type": "TypeString"
              },
              {
                "name": "Day of Week",
                "type": "TypeString"
              },
              {
                "name": "Fill Time",
                "type": "TypeString"
              },
              {
                "name": "Performance",
                "type": "TypeString"
              }
            ],
            "data": {
              "rows": [
                [
                  0.1,
                  "gap up",
                  "filled",
                  "Sunday",
                  "before 13:00",
                  "green"
                ],
                [
                  0.5,
                  "gap up",
                  "filled",
                  "Monday",
                  "before 13:00",
                  "green"
                ],
                [
                  1.0,
                  "gap up",
                  "not filled",
                  "Tuesday",
                  "",
                  "green"
                ],
                [
                  1.5,
                  "gap up",
                  "filled",
                  "Wednesday",
                  "before 13:00",
                  "green"
                ],
                [
                  2.0,
                  "gap up",
                  "not filled",
                  "Thursday",
                  "",
                  "green"
                ],
                [
                  2.5,
                  "gap up",
                  "filled",
                  "Friday",
                  "before 13:00",
                  "green"
                ],
                [
                  3.0,
                  "gap up",
                  "not filled",
                  "Saturday",
                  "",
                  "green"
                ],
                [
                  3.5,
                  "gap up",
                  "filled",
                  "Sunday",
                  "before 13:00",
                  "green"
                ],
                [
                  4.0,
                  "gap up",
                  "not filled",
                  "Monday",
                  "",
                  "green"
                ],
                [
                  4.5,
                  "gap up",
                  "filled",
                  "Tuesday",
                  "before 13:00",
                  "green"
                ]
              ]
            }
          }
        ]
      },
      "options": {
        "transform_name": "gap_report",
        "output_id": "test_gap_histogram_wide",
        "fill_time_pivot_hour": 13,
        "histogram_bins": 5,
        "inputs": "{gap_filled: gap_filled, gap_retrace: gap_retrace, gap_size: gap_size, psc: psc, psc_timestamp: psc_timestamp}",
        "timeframe": "1D"
      },
      "timestamp_columns": [
        "psc_timestamp",
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "Gap Report Histogram - Custom Bins",
      "input": {
        "gap_size": [
          0.2,
          0.4,
          0.6,
          0.8,
          1.0,
          1.2,
          1.4,
          1.6
        ],
        "gap_filled": [
          true,
          false,
          true,
          false,
          true,
          false,
          true,
          false
        ],
        "psc": [
          100.0,
          100.2,
          100.4,
          100.6,
          100.8,
          101.0,
          101.2,
          101.4
        ],
        "gap_retrace": [
          0.3,
          0.0,
          0.5,
          0.0,
          0.7,
          0.0,
          0.9000000000000001,
          0.0
        ],
        "psc_timestamp": [
          "2022-01-01T00:00:00",
          "2022-01-02T00:00:00",
          "2022-01-03T00:00:00",
          "2022-01-04T00:00:00",
          "2022-01-05T00:00:00",
          "2022-01-06T00:00:00",
          "2022-01-07T00:00:00",
          "2022-01-08T00:00:00"
        ],
        "c": [
          100.3,
          100.5,
          100.9,
          101.1,
          101.5,
          101.7,
          102.1,
          102.3
        ],
        "timestamp": [
          "2024-02-10T09:00:00",
          "2024-02-11T09:00:00",
          "2024-02-12T09:00:00",
          "2024-02-13T09:00:00",
          "2024-02-14T09:00:00",
          "2024-02-15T09:00:00",
          "2024-02-16T09:00:00",
          "2024-02-17T09:00:00"
        ]
      },
      "expect": {
        "type": "tearsheet",
        "cards": {
          "cards": [
            {
              "category": "Reports",
              "group_size": 4,
              "type": "WidgetCard",
              "data": [
                {
                  "title": "Total Gaps",
                  "value": 8,
                  "group": 0,
                  "type": "TypeInteger"
                },
                {
                  "title": "Gap Up %",
                  "value": 100.0,
                  "group": 1,
                  "type": "TypePercent"
                },
                {
                  "title": "Gap Down %",
                  "value": 0.0,
                  "group": 2,
                  "type": "TypePercent"
                },
                {
                  "title": "Fill Rate",
                  "value": 50.0,
                  "group": 3,
                  "type": "TypePercent"
                }
              ]
            }
          ]
        },
        "charts": [
          {
            "title": "Gap Fill Analysis",
            "category": "Reports",
            "type": "WidgetBarChart",
            "stacked": true,
            "vertical": false,
            "bars": [
              {
                "name": "Filled",
                "data": [
                  4,
                  0,
                  4
                ]
              },
              {
                "name": "Not Filled",
                "data": [
                  4,
                  0,
                  4
                ]
              }
            ]
          },
          {
            "title": "Gap Fill Rate by Size Category",
            "category": "Reports",
            "type": "WidgetBarChart",
            "stacked": true,
            "vertical": false,
            "bars": [
              {
                "name": "Filled",
                "data": [
                  0,
                  1,
                  0,
                  1,
                  2,
                  0
                ]
              },
              {
                "name": "Not Filled",
                "data": [
                  0,
                  0,
                  1,
                  1,
                  2,
                  0
                ]
              }
            ]
          },
          {
            "title": "Gap Fill Rate by Day of Week",
            "category": "Reports",
            "type": "WidgetBarChart",
            "stacked": true,
            "vertical": false,
            "bars": [
              {
                "name": "Filled",
                "data": [
                  1,
                  0,
                  1,
                  0,
                  1,
                  1,
                  0
                ]
              },
              {
                "name": "Not Filled",
                "data": [
                  0,
                  1,
                  0,
                  1,
                  0,
                  1,
                  1
                ]
              }
            ]
          },
          {
            "title": "Gap Size Distribution",
            "category": "Reports",
            "type": "WidgetHistogramChart",
            "bins": [
              {
                "min": 0.2,
                "max": 0.55,
                "count": 2
              },
              {
                "min": 0.55,
                "max": 0.9,
                "count": 2
              },
              {
                "min": 0.9,
                "max": 1.25,
                "count": 2
              },
              {
                "min": 1.25,
                "max": 1.6,
                "count": 2
              }
            ]
          }
        ],
        "tables": [
          {
            "title": "Gap Up Fill Analysis",
            "category": "Reports",
            "type": "WidgetDataTable",
            "columns": [
              {
                "name": "Category",
                "type": "TypeString"
              },
              {
                "name": "Frequency",
                "type": "TypeInteger"
              },
              {
                "name": "Percentage",
                "type": "TypePercent"
              }
            ],
            "data": {
              "rows": [
                [
                  "gap up",
                  8,
                  100.0
                ],
                [
                  "gap up filled",
                  4,
                  50.0
                ],
                [
                  "gap up not filled",
                  4,
                  50.0
                ]
              ]
            }
          },
          {
            "title": "Gap Down Fill Analysis",
            "category": "Reports",
            "type": "WidgetDataTable",
            "columns": [
              {
                "name": "Category",
                "type": "TypeString"
              },
              {
                "name": "Frequency",
                "type": "TypeInteger"
              },
              {
                "name": "Percentage",
                "type": "TypePercent"
              }
            ],
            "data": {
              "rows": [
                [
                  "gap down",
                  0,
                  0.0
                ],
                [
                  "gap down filled",
                  0,
                  0.0
                ],
                [
                  "gap down not filled",
                  0,
                  0.0
                ]
              ]
            }
          },
          {
            "title": "Gap Analysis Details",
            "category": "Reports",
            "type": "WidgetDataTable",
            "columns": [
              {
                "name": "Gap Size %",
                "type": "TypePercent"
              },
              {
                "name": "Gap Type",
                "type": "TypeString"
              },
              {
                "name": "Filled Status",
                "type": "TypeString"
              },
              {
                "name": "Day of Week",
                "type": "TypeString"
              },
              {
                "name": "Fill Time",
                "type": "TypeString"
              },
              {
                "name": "Performance",
                "type": "TypeString"
              }
            ],
            "data": {
              "rows": [
                [
                  0.2,
                  "gap up",
                  "filled",
                  "Saturday",
                  "before 13:00",
                  "green"
                ],
                [
                  0.4,
                  "gap up",
                  "not filled",
                  "Sunday",
                  "",
                  "green"
                ],
                [
                  0.6,
                  "gap up",
                  "filled",
                  "Monday",
                  "before 13:00",
                  "green"
                ],
                [
                  0.8,
                  "gap up",
                  "not filled",
                  "Tuesday",
                  "",
                  "green"
                ],
                [
                  1.0,
                  "gap up",
                  "filled",
                  "Wednesday",
                  "before 13:00",
                  "green"
                ],
                [
                  1.2,
                  "gap up",
                  "not filled",
                  "Thursday",
                  "",
                  "green"
                ],
                [
                  1.4,
                  "gap up",
                  "filled",
                  "Friday",
                  "before 13:00",
                  "green"
                ],
                [
                  1.6,
                  "gap up",
                  "not filled",
                  "Saturday",
                  "",
                  "green"
                ]
              ]
            }
          }
        ]
      },
      "options": {
        "transform_name": "gap_report",
        "output_id": "test_gap_histogram_custom",
        "fill_time_pivot_hour": 13,
        "histogram_bins": 4,
        "inputs": "{gap_filled: gap_filled, gap_retrace: gap_retrace, gap_size: gap_size, psc: psc, psc_timestamp: psc_timestamp}",
        "timeframe": "1D"
      },
      "timestamp_columns": [
        "psc_timestamp",
        "timestamp"
      ],
      "index_column": "timestamp"
    }
  ]
}