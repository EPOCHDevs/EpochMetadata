tests:
  - title: "Gap Report Comprehensive Test"
    input:
      type: "gap_report"
      timestamps: [
        "2024-01-08T09:30:00",  # Monday open - small gap up, filled
        "2024-01-08T15:55:00",  # Monday close
        "2024-01-09T09:30:00",  # Tuesday open - medium gap down, not filled
        "2024-01-09T15:55:00",  # Tuesday close
        "2024-01-10T09:30:00",  # Wednesday open - large gap up, filled
        "2024-01-10T15:55:00",  # Wednesday close
        "2024-01-11T09:30:00",  # Thursday open - tiny gap down, not filled
        "2024-01-11T15:55:00",  # Thursday close
        "2024-01-12T09:30:00",  # Friday open - medium gap up, not filled
        "2024-01-12T15:55:00"   # Friday close
      ]

      gap_filled: [
        true,   # Monday: gap filled
        ~,      # Monday close
        false,  # Tuesday: gap not filled
        ~,      # Tuesday close
        true,   # Wednesday: gap filled
        ~,      # Wednesday close
        false,  # Thursday: gap not filled
        ~,      # Thursday close
        false,  # Friday: gap not filled
        ~       # Friday close
      ]

      gap_size: [
        0.15,   # Monday: 0.15% gap up (0-0.19% category)
        ~,      # Monday close
        0.8,    # Tuesday: 0.8% gap down (0.6-0.99% category)
        ~,      # Tuesday close
        2.5,    # Wednesday: 2.5% gap up (2.0%+ category)
        ~,      # Wednesday close
        0.05,   # Thursday: 0.05% gap down (0-0.19% category)
        ~,      # Thursday close
        1.2,    # Friday: 1.2% gap up (1.0-1.99% category)
        ~       # Friday close
      ]

      psc: [
        100.0,  # Monday: previous session close
        ~,      # Monday close
        100.15, # Tuesday: Monday's close
        ~,      # Tuesday close
        99.35,  # Wednesday: Tuesday's close
        ~,      # Wednesday close
        101.85, # Thursday: Wednesday's close
        ~,      # Thursday close
        101.80, # Friday: Thursday's close
        ~       # Friday close
      ]

      c: [
        100.15, # Monday open (gap up from 100.0)
        100.15, # Monday close
        99.35,  # Tuesday open (gap down from 100.15)
        99.35,  # Tuesday close
        101.85, # Wednesday open (gap up from 99.35)
        101.85, # Wednesday close
        101.80, # Thursday open (gap down from 101.85)
        101.80, # Thursday close
        103.02, # Friday open (gap up from 101.80)
        103.02  # Friday close
      ]

    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 5
        - data:
          - title: "Gap Up %"
            value: 60  # 3 gap ups out of 5
        - data:
          - title: "Gap Down %"
            value: 40  # 2 gap downs out of 5
        - data:
          - title: "Fill Rate"
            value: 40  # 2 filled out of 5

      charts:
        # Chart 1: Fill Rate Stacked Bar Chart
        - type: "bar"
          title: "Fill Rate Analysis"
          x_axis:
            type: "category"
            categories: ["Gap Up", "Gap Down"]
          data:
            - name: "Filled"
              values: [2, 0]  # 2 gap ups filled, 0 gap downs filled
              stack: "fill_status"
            - name: "Not Filled"
              values: [1, 2]  # 1 gap up not filled, 2 gap downs not filled
              stack: "fill_status"

        # Chart 2: Gap Fill Rate by Size Category
        - type: "bar"
          title: "Gap Fill Rate by Size Category"
          x_axis:
            type: "category"
            categories: ["0-0.19%", "0.2-0.39%", "0.4-0.59%", "0.6-0.99%", "1.0-1.99%", "2.0%+"]
          data:
            - name: "Filled"
              values: [1, 0, 0, 0, 0, 1]  # 1 filled in 0-0.19%, 1 in 2.0%+
              stack: "fill_status"
            - name: "Not Filled"
              values: [1, 0, 0, 1, 1, 0]  # 1 not filled in each: 0-0.19%, 0.6-0.99%, 1.0-1.99%
              stack: "fill_status"

        # Chart 3: Gap Fill Rate by Day of Week
        - type: "bar"
          title: "Gap Fill Rate by Day of Week"
          x_axis:
            type: "category"
            categories: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
          data:
            - name: "Filled"
              values: [1, 0, 1, 0, 0, 0, 0]  # Monday and Wednesday filled
              stack: "fill_status"
            - name: "Not Filled"
              values: [0, 1, 0, 1, 1, 0, 0]  # Tuesday, Thursday, Friday not filled
              stack: "fill_status"

        # Chart 4: Gap Size Distribution Histogram
        - type: "histogram"
          title: "Gap Size Distribution"
          x_axis:
            label: "Gap Size (%)"
          y_axis:
            label: "Frequency"
          bins: 12
          data:
            - name: "gap_size"
              values: [0.15, 0.8, 2.5, 0.05, 1.2]

      tables:
        # Table 1: Gap Up Fill Analysis
        - title: "Gap Up Fill Analysis"
          type: "table"
          columns:
            - name: "category"
              type: "string"
            - name: "frequency"
              type: "integer"
            - name: "percentage"
              type: "percent"
          rows:
            - ["gap up", 3, 60.0]           # 3 gap ups out of 5 total
            - ["gap up filled", 2, 66.67]   # 2 out of 3 gap ups filled
            - ["gap up not filled", 1, 33.33] # 1 out of 3 gap ups not filled

        # Table 2: Gap Down Fill Analysis
        - title: "Gap Down Fill Analysis"
          type: "table"
          columns:
            - name: "category"
              type: "string"
            - name: "frequency"
              type: "integer"
            - name: "percentage"
              type: "percent"
          rows:
            - ["gap down", 2, 40.0]         # 2 gap downs out of 5 total
            - ["gap down filled", 0, 0.0]   # 0 out of 2 gap downs filled
            - ["gap down not filled", 2, 100.0] # 2 out of 2 gap downs not filled

    options:
      histogram_bins: 12