{
  "tests": [
    {
      "title": "SQL Query 4 - Complete OHLC timeseries",
      "input": {
        "timestamp": [
          "2024-01-01T09:30:00",
          "2024-01-01T09:31:00",
          "2024-01-01T09:32:00",
          "2024-01-01T09:33:00",
          "2024-01-01T09:34:00"
        ],
        "feed_data#o": [
          100.0,
          100.5,
          101.2,
          99.8,
          102.3
        ],
        "feed_data#h": [
          100.8,
          101.5,
          101.5,
          100.2,
          102.8
        ],
        "feed_data#l": [
          99.5,
          100.3,
          99.8,
          99.0,
          101.8
        ],
        "feed_data#c": [
          100.5,
          101.2,
          99.8,
          102.3,
          102.0
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "timestamp": [
            "2024-01-01 09:30:00.000000000",
            "2024-01-01 09:31:00.000000000",
            "2024-01-01 09:32:00.000000000",
            "2024-01-01 09:33:00.000000000",
            "2024-01-01 09:34:00.000000000"
          ],
          "ohlc_timeseries#RESULT0": [
            100.0,
            100.5,
            101.2,
            99.8,
            102.3
          ],
          "ohlc_timeseries#RESULT1": [
            100.8,
            101.5,
            101.5,
            100.2,
            102.8
          ],
          "ohlc_timeseries#RESULT2": [
            99.5,
            100.3,
            99.8,
            99.0,
            101.8
          ],
          "ohlc_timeseries#RESULT3": [
            100.5,
            101.2,
            99.8,
            102.3,
            102.0
          ]
        }
      },
      "options": {
        "transform_name": "sql_query_4",
        "sql": "SELECT timestamp, SLOT0 as RESULT0, SLOT1 as RESULT1, SLOT2 as RESULT2, SLOT3 as RESULT3 FROM self ORDER BY timestamp",
        "output_id": "ohlc_timeseries",
        "inputs": "{SLOT: [feed_data#o, feed_data#h, feed_data#l, feed_data#c]}",
        "timeframe": "1Min"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "SQL Query 4 - MACD components",
      "input": {
        "timestamp": [
          "2024-01-01T09:30:00",
          "2024-01-01T09:31:00",
          "2024-01-01T09:32:00",
          "2024-01-01T09:33:00",
          "2024-01-01T09:34:00",
          "2024-01-01T09:35:00",
          "2024-01-01T09:36:00"
        ],
        "price_stream#c": [
          100.0,
          100.5,
          101.0,
          100.8,
          101.5,
          102.0,
          101.8
        ],
        "price_stream#v": [
          150000.0,
          120000.0,
          180000.0,
          100000.0,
          140000.0,
          160000.0,
          110000.0
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "timestamp": [
            "2024-01-01 09:30:00.000000000",
            "2024-01-01 09:31:00.000000000",
            "2024-01-01 09:32:00.000000000",
            "2024-01-01 09:33:00.000000000",
            "2024-01-01 09:34:00.000000000",
            "2024-01-01 09:35:00.000000000",
            "2024-01-01 09:36:00.000000000"
          ],
          "macd_components#RESULT0": [
            100.0,
            100.5,
            101.0,
            100.8,
            101.5,
            102.0,
            101.8
          ],
          "macd_components#RESULT1": [
            100.0,
            100.25,
            100.5,
            100.77,
            101.1,
            101.43,
            101.77
          ],
          "macd_components#RESULT2": [
            100.0,
            100.25,
            100.5,
            100.58,
            100.76,
            101.16,
            101.42
          ],
          "macd_components#RESULT3": [
            0.0,
            0.0,
            0.0,
            0.19,
            0.34,
            0.27,
            0.35
          ]
        }
      },
      "options": {
        "transform_name": "sql_query_4",
        "sql": "SELECT timestamp, SLOT0 as RESULT0, ROUND(AVG(SLOT0) OVER (ORDER BY timestamp ROWS BETWEEN 2 PRECEDING AND CURRENT ROW), 2) as RESULT1, ROUND(AVG(SLOT0) OVER (ORDER BY timestamp ROWS BETWEEN 4 PRECEDING AND CURRENT ROW), 2) as RESULT2, ROUND(AVG(SLOT0) OVER (ORDER BY timestamp ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) - AVG(SLOT0) OVER (ORDER BY timestamp ROWS BETWEEN 4 PRECEDING AND CURRENT ROW), 2) as RESULT3 FROM self",
        "output_id": "macd_components",
        "inputs": "{SLOT: [price_stream#c, price_stream#v]}",
        "timeframe": "1Min"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "SQL Query 4 - Volume analysis metrics",
      "input": {
        "timestamp": [
          "2024-01-01T09:30:00",
          "2024-01-01T09:31:00",
          "2024-01-01T09:32:00",
          "2024-01-01T09:33:00",
          "2024-01-01T09:34:00"
        ],
        "market_data#c": [
          100.0,
          101.0,
          99.0,
          102.0,
          101.5
        ],
        "market_data#v": [
          1000.0,
          1500.0,
          2000.0,
          800.0,
          1200.0
        ],
        "market_data#trades": [
          50.0,
          75.0,
          120.0,
          40.0,
          65.0
        ],
        "market_data#vw": [
          100.1,
          101.0,
          99.1,
          102.0,
          101.5
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "timestamp": [
            "2024-01-01 09:30:00.000000000",
            "2024-01-01 09:31:00.000000000",
            "2024-01-01 09:32:00.000000000",
            "2024-01-01 09:33:00.000000000",
            "2024-01-01 09:34:00.000000000"
          ],
          "volume_analysis#RESULT0": [
            100000.0,
            151500.0,
            198000.0,
            81600.0,
            121800.0
          ],
          "volume_analysis#RESULT1": [
            20.0,
            20.0,
            16.67,
            20.0,
            18.46
          ],
          "volume_analysis#RESULT2": [
            100.0,
            100.6,
            99.89,
            100.21,
            100.45
          ],
          "volume_analysis#RESULT3": [
            1000.0,
            1250.0,
            1500.0,
            1325.0,
            1300.0
          ]
        }
      },
      "options": {
        "transform_name": "sql_query_4",
        "sql": "SELECT timestamp, SLOT0 * SLOT1 as RESULT0, ROUND(SLOT1 / SLOT2, 2) as RESULT1, ROUND(SUM(SLOT0 * SLOT1) OVER (ORDER BY timestamp ROWS UNBOUNDED PRECEDING) / SUM(SLOT1) OVER (ORDER BY timestamp ROWS UNBOUNDED PRECEDING), 2) as RESULT2, AVG(SLOT1) OVER (ORDER BY timestamp ROWS UNBOUNDED PRECEDING) as RESULT3 FROM self",
        "output_id": "volume_analysis",
        "inputs": "{SLOT: [market_data#c, market_data#v, market_data#trades, market_data#vw]}",
        "timeframe": "1Min"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "SQL Query 4 - Market regime indicators",
      "input": {
        "timestamp": [
          "2024-01-01T09:30:00",
          "2024-01-01T09:31:00",
          "2024-01-01T09:32:00",
          "2024-01-01T09:33:00",
          "2024-01-01T09:34:00"
        ],
        "ticker#c": [
          100.0,
          102.0,
          101.0,
          103.0,
          102.5
        ],
        "ticker#v": [
          1000.0,
          2000.0,
          1500.0,
          2500.0,
          1200.0
        ],
        "ticker#volatility": [
          0.5,
          0.8,
          0.6,
          1.0,
          0.7
        ],
        "ticker#vw": [
          100.1,
          102.0,
          101.0,
          103.0,
          102.5
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "timestamp": [
            "2024-01-01 09:30:00.000000000",
            "2024-01-01 09:31:00.000000000",
            "2024-01-01 09:32:00.000000000",
            "2024-01-01 09:33:00.000000000",
            "2024-01-01 09:34:00.000000000"
          ],
          "regime_indicators#RESULT0": [
            0.0,
            2.0,
            -1.0,
            2.0,
            -0.5
          ],
          "regime_indicators#RESULT1": [
            1000.0,
            1500.0,
            1500.0,
            1750.0,
            1640.0
          ],
          "regime_indicators#RESULT2": [
            0.5,
            0.65,
            0.6333,
            0.725,
            0.72
          ],
          "regime_indicators#RESULT3": [
            0,
            1,
            0,
            1,
            0
          ]
        }
      },
      "options": {
        "transform_name": "sql_query_4",
        "sql": "SELECT timestamp, COALESCE(SLOT0 - LAG(SLOT0, 1) OVER (ORDER BY timestamp), 0) as RESULT0, AVG(SLOT1) OVER (ORDER BY timestamp ROWS BETWEEN 4 PRECEDING AND CURRENT ROW) as RESULT1, AVG(SLOT2) OVER (ORDER BY timestamp ROWS UNBOUNDED PRECEDING) as RESULT2, CASE WHEN COALESCE(SLOT0 - LAG(SLOT0, 1) OVER (ORDER BY timestamp), 0) > 0 THEN 1 ELSE 0 END as RESULT3 FROM self",
        "output_id": "regime_indicators",
        "inputs": "{SLOT: [ticker#c, ticker#v, ticker#volatility, ticker#vw]}",
        "timeframe": "1Min"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    },
    {
      "title": "SQL Query 4 - Intraday statistics",
      "input": {
        "timestamp": [
          "2024-01-01T09:30:00",
          "2024-01-01T09:31:00",
          "2024-01-01T09:32:00",
          "2024-01-01T09:33:00",
          "2024-01-01T09:34:00",
          "2024-01-01T09:35:00"
        ],
        "ohlc_feed#o": [
          100.0,
          102.0,
          101.0,
          103.0,
          102.5,
          101.5
        ],
        "ohlc_feed#h": [
          102.0,
          102.5,
          103.0,
          103.5,
          103.0,
          102.0
        ],
        "ohlc_feed#l": [
          99.5,
          101.5,
          100.5,
          102.5,
          102.0,
          101.0
        ],
        "ohlc_feed#c": [
          100.0,
          102.0,
          101.0,
          103.0,
          102.5,
          101.5
        ]
      },
      "expect": {
        "type": "dataframe",
        "columns": {
          "timestamp": [
            "2024-01-01 09:30:00.000000000",
            "2024-01-01 09:31:00.000000000",
            "2024-01-01 09:32:00.000000000",
            "2024-01-01 09:33:00.000000000",
            "2024-01-01 09:34:00.000000000",
            "2024-01-01 09:35:00.000000000"
          ],
          "intraday_stats#RESULT0": [
            100.0,
            101.0,
            101.0,
            101.5,
            101.7,
            101.667
          ],
          "intraday_stats#RESULT1": [
            100.0,
            102.0,
            102.0,
            103.0,
            103.0,
            103.0
          ],
          "intraday_stats#RESULT2": [
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0
          ],
          "intraday_stats#RESULT3": [
            0,
            1,
            2,
            3,
            4,
            5
          ]
        }
      },
      "options": {
        "transform_name": "sql_query_4",
        "sql": "SELECT timestamp, ROUND(AVG(SLOT3) OVER (ORDER BY timestamp ROWS UNBOUNDED PRECEDING), 3) as RESULT0, MAX(SLOT3) OVER (ORDER BY timestamp ROWS UNBOUNDED PRECEDING) as RESULT1, MIN(SLOT3) OVER (ORDER BY timestamp ROWS UNBOUNDED PRECEDING) as RESULT2, ROW_NUMBER() OVER (ORDER BY timestamp) - 1 as RESULT3 FROM self",
        "output_id": "intraday_stats",
        "inputs": "{SLOT: [ohlc_feed#o, ohlc_feed#h, ohlc_feed#l, ohlc_feed#c]}",
        "timeframe": "1Min"
      },
      "timestamp_columns": [
        "timestamp"
      ],
      "index_column": "timestamp"
    }
  ]
}