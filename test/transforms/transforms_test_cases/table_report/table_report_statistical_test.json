{
  "tests": [
    {
      "title": "Table Report with Statistical Functions and Percentiles",
      "input": {
        "returns_analyzer#daily_pnl": [
          1000.0,
          -500.0,
          750.0,
          -200.0,
          1200.0,
          300.0,
          -800.0,
          600.0
        ],
        "risk_calculator#var": [
          0.05,
          0.08,
          0.06,
          0.04,
          0.09,
          0.05,
          0.12,
          0.07
        ],
        "benchmark_model#alpha": [
          0.02,
          -0.01,
          0.015,
          -0.005,
          0.025,
          0.008,
          -0.018,
          0.012
        ]
      },
      "expect": {
        "type": "tearsheet",
        "cards": {
          "cards": []
        },
        "tables": [
          {
            "title": "Portfolio Risk Statistics",
            "category": "Reports",
            "type": "WidgetDataTable",
            "columns": [
              {
                "name": "metric",
                "type": "TypeString"
              },
              {
                "name": "value",
                "type": "TypeDecimal"
              }
            ],
            "data": {
              "rows": [
                [
                  "avg_pnl",
                  293.75
                ],
                [
                  "max_pnl",
                  1200.0
                ],
                [
                  "min_pnl",
                  -800.0
                ],
                [
                  "negative_days",
                  3.0
                ],
                [
                  "positive_days",
                  5.0
                ],
                [
                  "total_pnl",
                  2350.0
                ],
                [
                  "volatility",
                  0.0725
                ],
                [
                  "win_rate",
                  0.625
                ]
              ]
            }
          }
        ]
      },
      "options": {
        "transform_name": "table_report",
        "sql": "SELECT * FROM (SELECT 'total_pnl' as metric, SUM(input0) as value FROM table UNION ALL SELECT 'avg_pnl' as metric, AVG(input0) as value FROM table UNION ALL SELECT 'max_pnl' as metric, MAX(input0) as value FROM table UNION ALL SELECT 'min_pnl' as metric, MIN(input0) as value FROM table UNION ALL SELECT 'volatility' as metric, AVG(input1) as value FROM table UNION ALL SELECT 'positive_days' as metric, COUNT(*) as value FROM table WHERE input0 > 0 UNION ALL SELECT 'negative_days' as metric, COUNT(*) as value FROM table WHERE input0 < 0 UNION ALL SELECT 'win_rate' as metric, CAST(SUM(CASE WHEN input0 > 0 THEN 1 ELSE 0 END) AS FLOAT) / COUNT(*) as value FROM table) AS combined ORDER BY metric",
        "title": "Portfolio Risk Statistics",
        "add_index": false,
        "output_id": "test_stats_table",
        "inputs": "{SLOT: [returns_analyzer#daily_pnl, risk_calculator#var, benchmark_model#alpha]}",
        "timeframe": "1D"
      }
    }
  ]
}