---
title: Regime Detection
page_type: reference
layout: default
order: 10
category: Strategies
description: Market regime detection - Trend vs Range, Volatility States, ADX/DMI, Vortex Indicator
parent: ./index.md
---

import { Callout } from 'fumadocs-ui/components/callout';

# Regime Detection

Objective trend/range classification, volatility states, multi-indicator regime scoring.

---

## Vortex Indicator

```python
src = market_data_source()

vtx = vortex(period=14)(src.h, src.l, src.c)

# Direction
bullish = vtx.plus_indicator > vtx.minus_indicator
bearish = vtx.minus_indicator > vtx.plus_indicator

# Strength (spread between lines)
spread = abs(vtx.plus_indicator - vtx.minus_indicator)
strong_trend = spread > 0.15
weak_choppy = spread < 0.05

# Crossover signals
cross_bull = crossover(vtx.plus_indicator, vtx.minus_indicator)
cross_bear = crossunder(vtx.plus_indicator, vtx.minus_indicator)

trade_signal_executor(entry=cross_bull, exit=cross_bear)
```

<Callout type="info">
Interpretation: Spread > 0.15 = strong directional, < 0.05 = ranging/choppy. Crossovers similar to DMI.
</Callout>

---

## ADX / DMI

```python
src = market_data_source()

adx_val = adx(period=14)(src.h, src.l, src.c)
di_result = di(period=14)(src.h, src.l, src.c)

# Trend strength (direction-agnostic)
strong_trend = adx_val > 25
ranging = adx_val < 20

# Direction
bullish = di_result.plus_di > di_result.minus_di

# Regime classification
strong_uptrend = strong_trend and bullish
strong_downtrend = strong_trend and not bullish

# Route strategy
trend_signal = ema(period=20)(src.c) > ema(period=50)(src.c)
mr_signal = rsi(period=14)(src.c) < 30

# Trend-follow in trending markets, mean-revert in ranges
entry = conditional_select(
    strong_trend, trend_signal,
    ranging, mr_signal,
    0
)

exit = not strong_trend

trade_signal_executor()(enter_long=entry, exit_long=exit)
```

---

## Volatility Regimes

```python
src = market_data_source()

vol = yang_zhang(period=20, trading_periods=252)(src.l, src.h, src.o, src.c)

# Percentile-based regime detection using percentile_select
very_low = percentile_select(lookback=252, percentile=20)(vol.result, 0, 1)  # Below 20th percentile
high_vol = percentile_select(lookback=252, percentile=80)(vol.result, 1, 0)  # Above 80th percentile
normal_vol = (very_low == 0) and (high_vol == 0)  # Between 20th-80th percentile

# Expansion/contraction
vol_ma = sma(period=50)(vol.result)
expanding = vol.result > vol_ma * 1.2
contracting = vol.result < vol_ma * 0.8

# Vol breakout
vol_squeeze = contracting[5] and expanding

trade_signal_executor()(enter_long=vol_squeeze and normal_vol)
```

---

## Trend vs Range Detection

```python
src = market_data_source()

# Multi-indicator confirmation
adx_val = adx(period=14)(src.h, src.l, src.c)
vtx = vortex(period=14)(src.h, src.l, src.c)
vol = yang_zhang(period=20, trading_periods=252)(src.l, src.h, src.o, src.c)

# Trending = ADX + Vortex confirm + reasonable vol
adx_trending = adx_val > 25
vtx_strong = abs(vtx.plus_indicator - vtx.minus_indicator) > 0.12
vol_ok = vol.result < 0.30

trending = adx_trending and vtx_strong and vol_ok

# Ranging = low ADX + low vortex spread
adx_ranging = adx_val < 20
vtx_weak = abs(vtx.plus_indicator - vtx.minus_indicator) < 0.08

ranging = adx_ranging and vtx_weak and vol_ok

# High vol chaos
chaos = vol.result >= 0.30
```

---

## Multi-Regime Scoring System

```python
src = market_data_source()

# Combine all indicators
adx_val = adx(period=14)(src.h, src.l, src.c)
di_result = di(period=14)(src.h, src.l, src.c)
vtx = vortex(period=14)(src.h, src.l, src.c)
vol = yang_zhang(period=20, trading_periods=252)(src.l, src.h, src.o, src.c)

# HMM for statistical regime
returns = (src.c / src.c[1] - 1) * 100

hmm_result = hmm(n_states=3, lookback_window=252)(returns)

# Regime scores
trending_score = (
    conditional_select(adx_val > 25, 1, 0) +
    conditional_select(abs(vtx.plus_indicator - vtx.minus_indicator) > 0.12, 1, 0)
)

bullish_score = (
    conditional_select(di_result.plus_di > di_result.minus_di, 1, 0) +
    conditional_select(vtx.plus_indicator > vtx.minus_indicator, 1, 0) +
    conditional_select(hmm_result.state == 2, 1, 0)
)

# Volatility regime using percentile_select
vol_very_low = percentile_select(lookback=252, percentile=20)(vol.result, 0, 1)
vol_high = percentile_select(lookback=252, percentile=80)(vol.result, 1, 0)

# Vol scoring: 0=very low, 1=normal, 2=high
vol_score = conditional_select(
    vol_very_low == 1, 0,
    vol_high == 1, 2,
    1
)

# Regime classification
strong_bull_trend = (trending_score >= 2) and (bullish_score >= 2) and (vol_score <= 1)
weak_bull = (bullish_score >= 2) and (trending_score < 2) and (vol_score <= 1)
high_vol_avoid = vol_score == 2

# Strategy routing based on regime
# strong_bull_trend: use trend-follow (EMA crossover)
# weak_bull: buy dips (RSI oversold)
# other regimes: avoid trading
entry = conditional_select(
    strong_bull_trend, ema(period=20)(src.c) > ema(period=50)(src.c),
    weak_bull, rsi(period=14)(src.c) < 35,
    0
)

exit = high_vol_avoid or not (strong_bull_trend or weak_bull)

trade_signal_executor()(enter_long=entry, exit_long=exit)
```

---

## Regime Transition Detection

```python
src = market_data_source()

# Track regime over time
adx_val = adx(period=14)(src.h, src.l, src.c)

trending_now = adx_val > 25
trending_prev = trending_now[1]

# Detect transitions
trend_to_range = trending_prev and not trending_now
range_to_trend = not trending_prev and trending_now

# Vol transitions
vol = yang_zhang(period=20, trading_periods=252)(src.l, src.h, src.o, src.c)
# Vol regime using percentile_select (50th percentile = median)
high_vol_now = percentile_select(lookback=252, percentile=50)(vol.result, 1, 0)  # Above median
high_vol_prev = high_vol_now[1]

vol_spike = not high_vol_prev and high_vol_now

# Transition = uncertain, reduce exposure
in_transition = trend_to_range or range_to_trend or vol_spike
stable_regime = not in_transition

entry_ok = stable_regime
```

<Callout type="tip">
Regime detection prevents applying trend-following strategies in ranging markets (and vice versa). This significantly improves strategy robustness.
</Callout>

**Next:** [Cross-Sectional Ranking](./cross-sectional-ranking)
